# 摇光(YaoGuang) SoC FMEDA报告

## 失效模式、影响和诊断分析

> **文档版本**: V1.0  
> **编制日期**: 2026-01-18  
> **状态**: 初稿  
> **适用标准**: ISO 26262:2018  
> **安全等级**: ASIL-D

---

## 1. 概述

### 1.1 目的

本文档是摇光SoC的**FMEDA(Failure Mode, Effects and Diagnostic Analysis)**报告。FMEDA是FMEA的扩展，增加了：

- 定量失效率分析
- 诊断覆盖率(DC)计算
- 安全指标计算(SPFM, LFM, PMHF)
- FIT率评估

### 1.2 FMEDA目标

| 目标 | 值 | 说明 |
|------|-----|------|
| 诊断覆盖率 | ≥ 99% | ASIL-D要求 |
| SPFM | ≥ 99% | 单点故障度量 |
| LFM | ≥ 90% | 潜伏故障度量 |
| PMHF | < 10 FIT | 随机硬件失效概率 |

### 1.3 参考标准

- ISO 26262:2018 Part 5
- IEC 61508-5
- SN29500 (失效率预测)

---

## 2. Safety Island FMEDA

### 2.1 Safety Island概览

| 参数 | 值 |
|------|-----|
| 架构 | 双核锁步Cortex-R52 |
| 频率 | 200 MHz |
| 电源域 | 独立VDD_SAFETY |
| 时钟域 | 独立PLL |

### 2.2 Safety Island失效率

| 组件 | 数量 | 失效率(FIT) | 总FIT |
|------|------|-------------|-------|
| Cortex-R52 Core | 2 | 50 | 100 |
| 比较器 | 4 | 5 | 20 |
| 看门狗 | 1 | 10 | 10 |
| 中断控制器 | 1 | 8 | 8 |
| 定时器 | 2 | 5 | 10 |
| ECC逻辑 | 2 | 15 | 30 |
| 时钟监控 | 1 | 5 | 5 |
| 复位控制器 | 1 | 5 | 5 |
| 寄存器文件 | 2 | 20 | 40 |
| **总计** | | | **228 FIT** |

### 2.3 Safety Island失效模式分析

| 失效模式 | 失效率(FIT) | 失效类型 | 安全相关 | 诊断机制 | DC | 残余风险 |
|---------|-------------|---------|---------|---------|-----|---------|
| 核0计算错误 | 30 | 单点故障 | 是 | 锁步比较 | 99% | 0.3 |
| 核1计算错误 | 30 | 单点故障 | 是 | 锁步比较 | 99% | 0.3 |
| 核0死锁 | 10 | 潜伏故障 | 是 | 看门狗 | 95% | 0.5 |
| 核1死锁 | 10 | 潜伏故障 | 是 | 看门狗 | 95% | 0.5 |
| 比较器卡住 | 5 | 单点故障 | 是 | 自检 | 90% | 0.5 |
| 看门狗失效 | 5 | 多点故障 | 是 | 冗余监控 | 99% | 0.05 |
| ECC不可纠正错误 | 8 | 单点故障 | 是 | ECC | 99% | 0.08 |
| 时钟偏移 | 8 | 潜伏故障 | 是 | 时钟监控 | 90% | 0.8 |
| 复位失控 | 5 | 多点故障 | 是 | 看门狗 | 99% | 0.05 |
| 寄存器翻转 | 15 | 单点故障 | 是 | ECC | 99% | 0.15 |

### 2.4 Safety Island安全指标

| 指标 | 计算值 | 要求 | 状态 |
|------|--------|------|------|
| 总失效率 | 228 FIT | - | - |
| 安全相关失效率 | 200 FIT | - | - |
| 单点故障失效率 | 98 FIT | < 10 FIT | ⚠️ 不满足 |
| 潜伏故障失效率 | 33 FIT | - | - |
| **SPFM** | 51% | ≥ 99% | ❌ 不满足 |
| **LFM** | 83.5% | ≥ 90% | ⚠️ 不满足 |
| **PMHF** | 98 FIT | < 10 FIT | ❌ 不满足 |

### 2.5 Safety Island改进建议

由于Safety Island是AS关注，需要提高诊断覆盖率：

| 改进措施 | 预期效果 | 实施难度 |
|----------|----------|----------|
| 增加三模冗余(TMR) | SPFM提升至99% | 高 |
| 增加周期性自检 | LFM提升至95% | 中 |
| 独立时钟监控 | DC提升至99.5% | 低 |
| 增强看门狗 | DC提升至99% | 低 |

---

## 3. NPU FMEDA

### 3.1 NPU概览

| 参数 | 值 |
|------|-----|
| 架构 | 4× Cluster |
| 算力 | 300+ TOPS |
| 本地SRAM | 8MB (每Cluster 2MB) |
| ECC | SECDED |

### 3.2 NPU失效率

| 组件 | 数量 | 失效率(FIT) | 总FIT |
|------|------|-------------|-------|
| PE Array | 1024×4 | 2 | 8192 |
| 激活函数单元 | 4×64 | 5 | 1280 |
| 权重寄存器 | 4×128 | 3 | 1536 |
| 累加器 | 4×256 | 4 | 4096 |
| 本地SRAM | 4×2MB | 50 | 200 |
| 调度器 | 1 | 30 | 30 |
| 控制逻辑 | 1 | 100 | 100 |
| **总计** | | | **14,438 FIT** |

### 3.3 NPU失效模式分析

| 失效模式 | 失效率(FIT) | 失效类型 | 安全相关 | 诊断机制 | DC | 残余风险 |
|---------|-------------|---------|---------|---------|-----|---------|
| PE固定0 | 3000 | 单点故障 | 是 | 输出校验 | 95% | 150 |
| PE固定1 | 3000 | 单点故障 | 是 | 输出校验 | 95% | 150 |
| PE瞬态错误 | 2000 | 瞬态故障 | 是 | 刷新+重算 | 99% | 20 |
| 权重翻转 | 500 | 单点故障 | 是 | ECC | 99.9% | 0.5 |
| 激活翻转 | 300 | 单点故障 | 是 | ECC | 99.9% | 0.3 |
| 累加器溢出 | 1000 | 潜伏故障 | 是 | 溢出检测 | 80% | 200 |
| 调度死锁 | 30 | 多点故障 | 是 | 超时检测 | 90% | 3 |
| SRAM软错误 | 100 | 瞬态故障 | 是 | ECC | 99% | 1 |
| SRAM硬错误 | 50 | 单点故障 | 是 | 冗余替换 | 99% | 0.5 |

### 3.4 NPU安全指标

| 指标 | 计算值 | 要求 | 状态 |
|------|--------|------|------|
| 总失效率 | 14,438 FIT | - | - |
| 安全相关失效率 | 8,000 FIT | - | - |
| 单点故障失效率 | 5,550 FIT | < 80 FIT | ❌ 不满足 |
| 潜伏故障失效率 | 1,230 FIT | - | - |
| **SPFM** | 30.6% | ≥ 99% | ❌ 不满足 |
| **LFM** | 84.6% | ≥ 90% | ⚠️ 不满足 |
| **PMHF** | 5,550 FIT | < 10 FIT | ❌ 不满足 |

### 3.5 NPU改进措施

| 改进措施 | 预期效果 | 实施成本 |
|----------|----------|----------|
| PE输出双路比较 | DC提升至99% | 中 |
| 周期性PE自检 | DC提升至99.5% | 中 |
| 累加器冗余设计 | DC提升至99% | 高 |
| 权重三模冗余 | 失效率降低50% | 高 |

---

## 4. CPU FMEDA

### 4.1 CPU概览

| 参数 | 值 |
|------|-----|
| 架构 | 4× Cortex-A78AE |
| 频率 | 2.0 GHz |
| L1 Cache | 256KB I + 256KB D |
| L2 Cache | 1MB (256KB×4) |

### 4.2 CPU失效率

| 组件 | 数量 | 失效率(FIT) | 总FIT |
|------|------|-------------|-------|
| Cortex-A78AE Core | 4 | 80 | 320 |
| ALU/FPU | 4×4 | 20 | 320 |
| L1 I-Cache | 256KB×4 | 30 | 120 |
| L1 D-Cache | 256KB×4 | 30 | 120 |
| L2 Cache | 1MB | 40 | 160 |
| 寄存器文件 | 4×64 | 15 | 960 |
| 流水线控制 | 4 | 50 | 200 |
| 中断控制器 | 1 | 20 | 20 |
| **总计** | | | **2,220 FIT** |

### 4.3 CPU失效模式分析

| 失效模式 | 失效率(FIT) | 失效类型 | 诊断机制 | DC |
|---------|-------------|---------|---------|-----|
| ALU错误 | 80/核 | 单点故障 | 锁步校验 | 95% |
| 寄存器翻转 | 240/核 | 单点故障 | ECC | 99% |
| L1 Cache错误 | 30/核 | 单点故障 | ECC | 99% |
| L2 Cache错误 | 40 | 单点故障 | ECC | 99% |
| 分支预测错误 | 20/核 | 潜伏故障 | 无 | 0% |
| 流水线停顿 | 30/核 | 潜伏故障 | 超时检测 | 60% |
| 中断丢失 | 10 | 单点故障 | 中断状态检查 | 80% |
| MMU错误 | 40/核 | 单点故障 | 地址检查 | 90% |

### 4.4 CPU安全指标

| 指标 | 计算值 | 要求 | 状态 |
|------|--------|------|------|
| 总失效率 | 2,220 FIT | - | - |
| 单点故障失效率 | 1,200 FIT | < 22 FIT | ❌ 不满足 |
| **SPFM** | 45.9% | ≥ 99% | ❌ 不满足 |
| **LFM** | 70% | ≥ 90% | ❌ 不满足 |

---

## 5. 存储系统 FMEDA

### 5.1 存储系统概览

| 类型 | 大小 | ECC | 失效率(FIT/MB) |
|------|------|-----|----------------|
| SRAM | 4MB | SECDED | 50 |
| L1 Cache | 512KB | SECDED | 50 |
| L2 Cache | 1MB | SECDED | 50 |
| L3 Cache | 3MB | SECDED | 50 |
| Register File | 256KB | SECDED | 100 |

### 5.2 存储系统失效率

| 组件 | 大小 | 失效率(FIT) | ECC覆盖 | 残余FIT |
|------|------|-------------|---------|---------|
| L1 Cache | 512KB | 25.6 | 99.9% | 0.026 |
| L2 Cache | 1MB | 50 | 99.9% | 0.05 |
| L3 Cache | 3MB | 150 | 99.9% | 0.15 |
| Register File | 256KB | 25.6 | 99% | 0.256 |
| 本地SRAM | 8MB | 400 | 99% | 4 |

### 5.3 存储系统安全指标

| 指标 | 计算值 | 要求 | 状态 |
|------|--------|------|------|
| 总失效率 | 651.2 FIT | - | - |
| 单点故障失效率 | 6.5 FIT | < 6.5 FIT | ⚠️ 边界 |
| **SPFM** | 99% | ≥ 99% | ✅ 满足 |
| **LFM** | 95% | ≥ 90% | ✅ 满足 |

---

## 6. 时钟与电源 FMEDA

### 6.1 时钟系统失效率

| 组件 | 失效率(FIT) | 诊断机制 | DC | 残余风险 |
|------|-------------|---------|-----|---------|
| 主PLL | 50 | 时钟监控 | 95% | 2.5 |
| 安全PLL | 30 | 独立监控 | 99% | 0.3 |
| 时钟分配 | 100 | 监控+看门狗 | 90% | 10 |
| RTC | 10 | 计时校验 | 80% | 2 |
| **总计** | **190 FIT** | | | **14.8 FIT** |

### 6.2 电源系统失效率

| 组件 | 失效率(FIT) | 诊断机制 | DC | 残余风险 |
|------|-------------|---------|-----|---------|
| DC-DC | 80 | 电压监控 | 95% | 4 |
| LDO | 40 | 电压监控 | 90% | 4 |
| 电压监控 | 20 | 自检 | 80% | 4 |
| **总计** | **140 FIT** | | | **12 FIT** |

---

## 7. 全芯片FMEDA汇总

### 7.1 按模块失效率汇总

| 模块 | 总FIT | 安全相关FIT | SPF FIT | LF FIT | PMHF |
|------|-------|-------------|---------|--------|------|
| Safety Island | 228 | 228 | 98 | 33 | 98 |
| NPU | 14,438 | 8,000 | 5,550 | 1,230 | 5,550 |
| CPU | 2,220 | 2,000 | 1,200 | 600 | 1,200 |
| 存储系统 | 651 | 600 | 6.5 | 30 | 6.5 |
| 时钟/电源 | 330 | 330 | 26.8 | 50 | 26.8 |
| 通信接口 | 200 | 100 | 10 | 20 | 10 |
| **总计** | **18,067 FIT** | **11,258 FIT** | **6,891.3 FIT** | **1,963 FIT** | **6,891.3 FIT** |

### 7.2 全芯片安全指标

| 指标 | 计算值 | ASIL-D要求 | 状态 |
|------|--------|------------|------|
| PMHF | 6,891 FIT | < 10 FIT | ❌ 不满足 |
| SPFM | 38.8% | ≥ 99% | ❌ 不满足 |
| LFM | 82.6% | ≥ 90% | ❌ 不满足 |

### 7.3 结论

当前设计**不满足ASIL-D安全指标**，主要原因：

1. **NPU失效率过高**
   - PE阵列失效率占总量45%
   - 需要增强冗余和校验

2. **CPU冗余不足**
   - 缺乏硬件级冗余
   - 需要增加锁步或校验

3. **Safety Island需要加强**
   - 当前为双模冗余
   - 建议采用三模冗余

---

## 8. 改进建议

### 8.1 架构改进

| 改进项 | 预期效果 | 实施成本 |
|--------|----------|----------|
| NPU TMR设计 | PMHF降低80% | 高 |
| Safety Island TMR | SPFM提升至99% | 高 |
| CPU锁步校验 | PMHF降低50% | 中 |
| 增强ECC覆盖 | DC提升至99.9% | 低 |

### 8.2 推荐的最终架构

```
┌─────────────────────────────────────────────────────────────┐
│                    推荐的Safety Island架构                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────┐  ┌─────────┐  ┌─────────┐                    │
│   │  R52-0  │  │  R52-1  │  │  R52-2  │ ← 三模冗余        │
│   └────┬────┘  └────┬────┘  └────┬────┘                    │
│        │            │            │                          │
│        └────────────┼────────────┘                          │
│                     │                                       │
│              ┌──────▼──────┐                                │
│              │   多数投票   │                                │
│              │   (Vote)    │                                │
│              └──────┬──────┘                                │
│                     │                                       │
│              ┌──────▼──────┐                                │
│              │   错误检测   │                                │
│              │             │                                │
│              └─────────────┘                                │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 8.3 改进后预期指标

| 指标 | 当前值 | 改进后目标 | 达标可能性 |
|------|--------|------------|------------|
| PMHF | 6,891 FIT | < 10 FIT | 需要TMR |
| SPFM | 38.8% | ≥ 99% | 需要TMR |
| LFM | 82.6% | ≥ 90% | 可达成 |

---

## 审批

| 角色 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| 编制 | 功能安全专家 | | 2026-01-18 |
| 审核 | | | |
| 批准 | | | |

---

**文档版本**: V1.0  
**最后更新**: 2026-01-18  
**状态**: 初稿
