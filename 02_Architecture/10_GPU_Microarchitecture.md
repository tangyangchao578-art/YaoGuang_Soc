# 摇光(YaoGuang) SoC GPU 微架构规格

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | V1.0 |
| 创建日期 | 2026-01-19 |
| 最后更新 | 2026-01-19 |
| 状态 | 草稿 |
| 负责人 | GPU 架构师 |
| 关联文档 | 架构规格书 (01_Architecture_Spec_YaoGuang_SoC.md) |

---

## 1. 概述

### 1.1 GPU 设计目标

| 指标 | 目标值 | 备注 |
|------|--------|------|
| **FP32 性能** | ≥ 2 TFLOPS | 2 核总计 |
| **FP16 性能** | ≥ 4 TFLOPS | 加速模式 |
| **频率** | 1.0-1.5 GHz | DVFS |
| **核心数** | 2 | Mali-G78AE 等效 |
| **执行单元** | 64 EU/核 | 128 EU 总计 |
| **功耗预算** | ≤ 7W | 峰值 |
| **面积预算** | ≤ 8 mm² | 约占 7% |
| **API 支持** | Vulkan 1.2 / OpenCL 3.0 | |

### 1.2 GPU 特性

| 特性 | 支持 | 说明 |
|------|------|------|
| **Vulkan 1.2** | 是 | 图形 API |
| **OpenCL 3.0** | 是 | 计算 API |
| **OpenGL ES 3.2** | 是 | 图形 API |
| **DirectX 12** | 否 | 移动端优化 |
| **Ray Tracing** | 否 | 硬件加速 |
| **Machine Learning** | 是 | INT8/FP16 计算 |

---

## 2. GPU 架构

### 2.1 系统架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           GPU 架构                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    Command Processor                            │   │
│  │  - Job Manager                                                  │   │
│  │  - Context Management                                           │   │
│  │  - Shader Preloader                                            │   │
│  └────────────────────────────┬────────────────────────────────────┘   │
│                               │                                          │
│                               ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    Tiler (Fragment)                             │   │
│  │  - Tile-Based Deferred Rendering                               │   │
│  │  - 16x16 / 32x32 tile size                                     │   │
│  │  - Hierarchical Z-buffer                                       │   │
│  └────────────────────────────┬────────────────────────────────────┘   │
│                               │                                          │
│                               ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │               Shader Core Cluster 0 (32 EU)                    │   │
│  │  ┌─────────────────────────────────────────────────────────┐   │   │
│  │  │  Execution Unit (EU) x 32                                │   │   │
│  │  │  - 128 ALUs / EU                                         │   │   │
│  │  │  - 64-bit FP32 / cycle                                   │   │   │
│  │  │  - 32-bit INT32 / cycle                                  │   │   │
│  │  └─────────────────────────────────────────────────────────┘   │   │
│  │  ┌─────────────────────────────────────────────────────────┐   │   │
│  │  │  Uniform Cache (32 KB)                                  │   │   │
│  │  │  Texture Cache (64 KB L1)                               │   │   │
│  │  │  Load/Store Cache (32 KB)                               │   │   │
│  │  └─────────────────────────────────────────────────────────┘   │   │
│  └────────────────────────────┬────────────────────────────────────┘   │
│                               │                                          │
│                               ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │               Shader Core Cluster 1 (32 EU)                    │   │
│  │  (同 Cluster 0 配置)                                           │   │
│  └────────────────────────────┬────────────────────────────────────┘   │
│                               │                                          │
│                               ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    L2 Cache (2 MB)                             │   │
│  │  - 16-way                                                     │   │
│  │  - ECC 保护                                                   │   │
│  └────────────────────────────┬────────────────────────────────────┘   │
│                               │                                          │
│                               ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    AXI Interface                                │   │
│  │  - ACE4 一致性接口                                             │   │
│  │  - 256-bit 位宽                                                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 核心配置

| 参数 | Cluster 0 | Cluster 1 | 总计 |
|------|-----------|-----------|------|
| **EU 数量** | 32 | 32 | 64 |
| **ALU/EU** | 128 | 128 | 256 |
| **FP32 算力** | 1 TFLOPS | 1 TFLOPS | 2 TFLOPS |
| **L1 Cache** | 128 KB | 128 KB | 256 KB |
| **共享内存** | 64 KB | 64 KB | 128 KB |

---

## 3. Execution Unit (EU) 架构

### 3.1 EU 配置

| 参数 | 规格 |
|------|------|
| **流水线** | 8 级 |
| **发射宽度** | 2-way SIMD |
| **ALU 数量** | 128 (64-bit 单元) |
| **FP32 单元** | 2 (128-bit / cycle) |
| **INT32 单元** | 2 (128-bit / cycle) |
| **纹理单元** | 1 |
| **加载/存储** | 1 |

### 3.2 执行单元规格

| 功能 | 吞吐量 | 延迟 |
|------|--------|------|
| **FP32 ADD** | 2 ops/cycle | 4 cycles |
| **FP32 MUL** | 2 ops/cycle | 5 cycles |
| **FP32 FMA** | 2 ops/cycle | 6 cycles |
| **INT32 ADD** | 2 ops/cycle | 1 cycle |
| **INT32 MUL** | 2 ops/cycle | 3 cycles |
| **FP16 FMA** | 4 ops/cycle | 6 cycles |
| **INT8 MAD** | 8 ops/cycle | 4 cycles |

---

## 4. 缓存层次结构

### 4.1 L1 Cache

| 参数 | Texture Cache | Uniform Cache | Load/Store |
|------|---------------|---------------|------------|
| **大小** | 64 KB | 32 KB | 32 KB |
| **关联度** | 4-way | 4-way | 4-way |
| **块大小** | 64 Bytes | 32 Bytes | 64 Bytes |
| **带宽** | 256-bit/cycle | 128-bit/cycle | 256-bit/cycle |

### 4.2 L2 Cache

| 参数 | 规格 |
|------|------|
| **大小** | 2 MB |
| **关联度** | 16-way |
| **块大小** | 64 Bytes |
| **延迟** | 15-20 cycles |
| **带宽** | 128-bit/cycle |
| **ECC** | SECDED |

---

## 5. 渲染管线

### 5.1 图形管线阶段

| 阶段 | 模块 | 处理能力 |
|------|------|----------|
| **Vertex Shader** | EU | 顶点变换 |
| **Tessellation** | EU | 曲面细分 |
| **Geometry Shader** | EU | 几何处理 |
| **Rasterization** | Rasterizer | 光栅化 |
| **Early Z** | Z/S Test | 深度测试 |
| **Fragment Shader** | EU | 片段着色 |
| **Late Z** | Z/S Test | 深度测试 |
| **Blending** | ROP | 颜色混合 |

### 5.2 渲染性能

| 分辨率 | 帧率 | 三角形/s | 像素/s |
|--------|------|----------|--------|
| **4K (3840x2160)** | 60 fps | 500M | 5.0G |
| **1080p (1920x1080)** | 120 fps | 1.0G | 2.5G |
| **720p (1280x720)** | 240 fps | 1.5G | 1.1G |

---

## 6. 计算管线

### 6.1 计算能力

| 特性 | 支持 | 说明 |
|------|------|------|
| **OpenCL 3.0** | 是 | 通用计算 |
| **Work-group** | 最大 256 | 线程组 |
| **Work-item** | 最大 256 | 线程数 |
| **Local Memory** | 64 KB/EU | 共享内存 |
| **图像支持** | 是 | OpenCL Image |

### 6.2 计算性能

| 数据类型 | 算力 | 备注 |
|----------|------|------|
| **FP32** | 2 TFLOPS | 单精度 |
| **FP16** | 4 TFLOPS | 半精度 |
| **INT8** | 8 TOPS | 整数 |
| **INT4** | 16 TOPS | 量化 |

---

## 7. 功耗管理

### 7.1 功耗预算

| 模块 | 动态功耗 (W) | 静态功耗 (W) | 峰值功耗 (W) |
|------|--------------|--------------|--------------|
| **EU Cluster 0** | 2.0 | 0.4 | 2.4 |
| **EU Cluster 1** | 2.0 | 0.4 | 2.4 |
| **L2 Cache** | 0.5 | 0.2 | 0.7 |
| **Tiler** | 0.5 | 0.1 | 0.6 |
| **命令处理** | 0.3 | 0.1 | 0.4 |
| **时钟树** | 0.3 | 0.1 | 0.4 |
| **总计** | **5.6** | **1.3** | **6.9** |

### 7.2 功耗优化

| 技术 | 应用 | 节省功耗 |
|------|------|----------|
| **时钟门控** | 空闲 EU | 30-40% |
| **频率缩放** | DVFS | 10-20% |
| **电压缩放** | 动态电压 | 10-15% |
| **模块关断** | 未使用模块 | 40-60% |

---

## 8. 面积分析

### 8.1 面积预算

| 模块 | 面积 (mm²) | 占比 |
|------|------------|------|
| **EU Cluster 0** | 2.5 | 31% |
| **EU Cluster 1** | 2.5 | 31% |
| **L2 Cache (2 MB)** | 1.0 | 13% |
| **Tiler** | 0.8 | 10% |
| **命令处理** | 0.5 | 6% |
| **时钟复位** | 0.4 | 5% |
| **其他** | 0.3 | 4% |
| **总计** | **8.0** | **100%** |

---

## 9. 接口规格

### 9.1 ACE 接口

| 参数 | 规格 |
|------|------|
| **协议** | ACE4 |
| **位宽** | 256-bit |
| **频率** | 1.5 GHz |
| **带宽** | 64 GB/s (双向) |
| **一致性** | 缓存一致性 |

### 9.2 中断接口

| 中断 | 功能 |
|------|------|
| **Job Complete** | 作业完成中断 |
| **GPU Fault** | GPU 错误中断 |
| **Context Fault** | 上下文错误 |

---

## 10. 安全机制

### 10.1 安全特性

| 特性 | 支持 | ASIL 等级 |
|------|------|-----------|
| **地址校验** | 是 | ASIL-B |
| **ECC 保护** | L2 Cache | ASIL-B |
| **看门狗** | 作业超时 | ASIL-B |
| **内存保护** | MMU | ASIL-B |

---

## 11. 验证计划

### 11.1 验证目标

| 验证类型 | 覆盖率目标 | 工具 |
|----------|------------|------|
| **功能覆盖率** | 100% | UVM |
| **图形测试** | 100% | Shader 测试 |
| **计算测试** | 100% | OpenCL 测试 |
| **性能测试** | 目标达成 | 基准测试 |

### 11.2 验证用例

| 用例类别 | 用例数 | 说明 |
|----------|--------|------|
| **图形测试** | 200+ | 渲染测试 |
| **计算测试** | 100+ | OpenCL 测试 |
| **异常测试** | 100+ | 错误注入测试 |
| **性能测试** | 50+ | 基准测试 |

---

## 12. 交付物和时间表

| 交付物 | 截止日期 | 状态 |
|--------|----------|------|
| GPU 微架构规格 | 2026-02-28 | 进行中 |
| EU 设计 | 2026-04-15 | 未开始 |
| RTL 代码冻结 | 2026-08-31 | 未开始 |
| DV 验证通过 | 2026-11-30 | 未开始 |

---

## 13. 审批

| 角色 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| GPU 架构师 | [待确认] | - | - |
| 首席架构师 | [待确认] | - | - |
| 项目经理 | [待确认] | - | - |

---

**文档版本**: V1.0  
**最后更新**: 2026-01-19  
**状态**: 草稿  
**下一步**: 开始 RTL 代码开发

---
*本规格书作为 GPU 子系统详细设计的指导文件。*