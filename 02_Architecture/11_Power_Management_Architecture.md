# 摇光(YaoGuang) SoC 电源管理架构规格

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | V1.0 |
| 创建日期 | 2026-01-19 |
| 最后更新 | 2026-01-19 |
| 状态 | 草稿 |
| 负责人 | Power 架构师 |
| 关联文档 | 架构规格书 (01_Architecture_Spec_YaoGuang_SoC.md) |

---

## 1. 概述

### 1.1 电源管理设计目标

| 指标 | 目标值 | 备注 |
|------|--------|------|
| **功耗预算** | ≤ 60W | 峰值 |
| **静态功耗** | ≤ 5W | 待机 |
| **能效比** | ≥ 5 TOPS/W | NPU |
| **电源域数** | 8 | 可独立控制 |
| **DVFS 级数** | 16 | 细粒度频率调节 |
| **上电序列** | 可编程 | 支持多种模式 |

### 1.2 功耗优化策略

| 策略 | 应用 | 节省功耗 |
|------|------|----------|
| **时钟门控** | 所有模块 | 20-30% |
| **电源门控** | 空闲模块 | 40-60% |
| **DVFS** | CPU/NPU/GPU | 10-20% |
| **SRAM 关闭** | 低功耗模式 | 10-20% |
| **体偏置** | 关键路径 | 5-10% |

---

## 2. 电源域架构

### 2.1 电源域定义

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           电源域架构                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│     ┌─────────────────────────────────────────────────────────────┐    │
│     │                   外部电源输入 (5V)                          │    │
│     └────────────────────────────┬───────────────────────────────┘    │
│                                  │                                        │
│                                  ▼                                        │
│     ┌─────────────────────────────────────────────────────────────┐    │
│     │                PMU (电源管理单元)                            │    │
│     │  - 电源选择                                                  │    │
│     │  - 上电序列                                                  │    │
│     │  - 电压监测                                                  │    │
│     └────────────────────────────┬───────────────────────────────┘    │
│                                  │                                        │
│       ┌─────────────┬────────────┼─────────────┬─────────────┐         │
│       ▼             ▼            ▼             ▼             ▼         │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐       │
│  │ PD_CPU  │  │PD_SAFETY│  │ PD_NPU  │  │ PD_GPU  │  │ PD_NOC  │       │
│  │ 0.8-1.0V│  │ 0.8-1.0V│  │ 0.8-1.0V│  │ 0.8-1.0V│  │ 0.8-1.0V│       │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘       │
│       │             │            │             │             │         │
│       ▼             ▼            ▼             ▼             ▼         │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐       │
│  │PD_MEM   │  │ PD_SYS  │  │ PD_IO   │  │ PD_ANA  │  │ PD_RTC  │       │
│  │ 0.8V    │  │ 0.8V    │  │ 1.8/3.3V│  │ 0.8V    │  │ 1.2V    │       │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 电源域详情

| 电源域 | 电压范围 | 面积 (mm²) | 功耗 (W) | 门控支持 |
|--------|----------|------------|----------|----------|
| **PD_CPU** | 0.7-1.0V | 24.0 | 15.0 | 是 |
| **PD_SAFETY** | 0.7-1.0V | 4.0 | 4.0 | 是 |
| **PD_NPU** | 0.7-1.0V | 36.0 | 25.0 | 是 |
| **PD_GPU** | 0.7-1.0V | 8.0 | 7.0 | 是 |
| **PD_NOC** | 0.7-0.9V | 8.0 | 3.0 | 是 |
| **PD_MEM** | 0.8V | 10.0 | 2.5 | 否 |
| **PD_SYS** | 0.8V | 5.0 | 2.0 | 是 |
| **PD_IO** | 1.8/3.3V | 3.0 | 1.5 | 部分 |
| **PD_ANA** | 0.8V | 1.0 | 0.5 | 部分 |
| **PD_RTC** | 1.2V | 0.2 | 0.1 | 独立 |

---

## 3. 电压调节器

### 3.1 电压调节器配置

| 调节器类型 | 数量 | 输出电压 | 电流能力 | 效率 |
|------------|------|----------|----------|------|
| **LDO (高速)** | 4 | 0.7-1.0V | 10A | 85% |
| **LDO (低速)** | 6 | 0.7-1.0V | 2A | 90% |
| **DC-DC (大电流)** | 2 | 0.7-1.0V | 30A | 92% |
| **DCDC (IO)** | 2 | 1.8V/3.3V | 5A | 95% |
| **DCDC (RTC)** | 1 | 1.2V | 100mA | 85% |

### 3.2 电压监控

| 监控点 | 精度 | 采样率 | 响应 |
|--------|------|--------|------|
| **VDD_CPU** | ±1% | 1 MHz | < 1 μs |
| **VDD_NPU** | ±1% | 1 MHz | < 1 μs |
| **VDD_GPU** | ±1% | 1 MHz | < 1 μs |
| **VDD_IO** | ±2% | 100 kHz | < 10 μs |
| **VDD_MEM** | ±1% | 1 MHz | < 1 μs |

---

## 4. PMU (电源管理单元)

### 4.1 PMU 功能

| 功能 | 支持 | 说明 |
|------|------|------|
| **电源序列控制** | 是 | 可编程上电/下电序列 |
| **电压监测** | 是 | 实时电压监控 |
| **温度监测** | 是 | 多点温度传感 |
| **功耗统计** | 是 | 模块级功耗统计 |
| **看门狗** | 是 | 系统看门狗 |
| **低功耗模式** | 是 | 多级低功耗 |
| **DVFS 控制** | 是 | 动态电压频率调节 |

### 4.2 PMU 架构

```
┌─────────────────────────────────────────────────────────────────┐
│                    PMU (电源管理单元)                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                 电源控制逻辑 (FSM)                       │   │
│  │  - 上电序列生成器                                        │   │
│  │  - 下电序列生成器                                        │   │
│  │  - 状态机控制                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                          │                                        │
│         ┌────────────────┼────────────────┐                      │
│         ▼                ▼                ▼                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐              │
│  │ 电压调节器  │  │ 时钟控制    │  │ 复位控制    │              │
│  │ 控制接口    │  │ 模块        │  │ 模块        │              │
│  └─────────────┘  └─────────────┘  └─────────────┘              │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                 监控与保护模块                           │   │
│  │  - 电压监控器 (10 通道)                                 │   │
│  │  - 温度传感器 (8 点)                                    │   │
│  │  - 电流监测器 (5 通道)                                  │   │
│  │  - 看门狗定时器                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                 功耗统计模块                             │   │
│  │  - 模块级功耗统计                                        │   │
│  │  - 动态功耗计算                                          │   │
│  │  - 静态功耗计算                                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 5. DVFS (动态电压频率调节)

### 5.1 DVFS 策略

| 场景 | CPU 频率 | NPU 频率 | GPU 频率 | 电压 |
|------|----------|----------|----------|------|
| **高性能** | 2.0 GHz | 2.0 GHz | 1.5 GHz | 1.0V |
| **均衡** | 1.5 GHz | 1.5 GHz | 1.2 GHz | 0.9V |
| **节能** | 1.0 GHz | 1.0 GHz | 0.8 GHz | 0.8V |
| **低功耗** | 0.5 GHz | 0.5 GHz | 0.4 GHz | 0.7V |
| **待机** | OFF | OFF | OFF | OFF |

### 5.2 DVFS 响应

| 事件 | 响应时间 | 频率调整 | 电压调整 |
|------|----------|----------|----------|
| **负载增加** | < 100 μs | 升频 | 升压 |
| **负载减少** | < 200 μs | 降频 | 降压 |
| **温度告警** | < 50 μs | 降频 | 降压 |
| **功耗超限** | < 50 μs | 降频 | 降压 |

---

## 6. 低功耗模式

### 6.1 低功耗模式定义

| 模式 | CPU | NPU | GPU | 内存 | 功耗 |
|------|-----|-----|-----|------|------|
| **Active** | 运行 | 运行 | 运行 | Active | 55W |
| **Idle** | WFI | WFI | WFI | Self-refresh | 15W |
| **Standby** | Power-down | Power-down | Power-down | Self-refresh | 5W |
| **Sleep** | Power-gate | Power-gate | Power-gate | Power-down | 2W |
| **Deep Sleep** | Power-gate | Power-gate | Power-gate | Power-down | 0.5W |
| **Shutdown** | OFF | OFF | OFF | OFF | 0.1W |

### 6.2 唤醒源

| 唤醒源 | 延迟 | 用途 |
|--------|------|------|
| **GPIO 中断** | < 100 μs | 外设唤醒 |
| **RTC 闹钟** | < 500 μs | 定时唤醒 |
| **CAN 报文** | < 200 μs | 车载唤醒 |
| **USB 插入** | < 300 μs | USB 唤醒 |
| **看门狗** | < 50 μs | 系统恢复 |

---

## 7. 功耗统计

### 7.1 功耗监测

| 模块 | 监测精度 | 采样率 | 更新率 |
|------|----------|--------|--------|
| **CPU** | ±2% | 1 MHz | 1 ms |
| **NPU** | ±2% | 1 MHz | 1 ms |
| **GPU** | ±2% | 1 MHz | 1 ms |
| **Memory** | ±3% | 100 kHz | 10 ms |
| **IO** | ±5% | 100 kHz | 10 ms |

### 7.2 功耗预算

| 模块 | 动态功耗 (W) | 静态功耗 (W) | 峰值功耗 (W) |
|------|--------------|--------------|--------------|
| **CPU** | 12.0 | 1.5 | 15.0 |
| **NPU** | 20.0 | 2.0 | 25.0 |
| **GPU** | 5.5 | 0.7 | 7.0 |
| **NoC** | 2.5 | 0.4 | 3.0 |
| **Memory** | 2.0 | 0.3 | 2.5 |
| **IO** | 1.2 | 0.2 | 1.5 |
| **时钟复位** | 1.0 | 0.3 | 1.5 |
| **PMU** | 0.3 | 0.1 | 0.5 |
| **总计** | **44.5** | **5.5** | **56.0** |

---

## 8. 温度管理

### 8.1 温度传感器

| 参数 | 规格 |
|------|------|
| **传感器数量** | 8 |
| **位置** | CPU, NPU, GPU, NoC, Memory, IO, PMU, 外部 |
| **精度** | ±1°C |
| **范围** | -40°C to +150°C |
| **采样率** | 10 kHz |

### 8.2 热管理策略

| 温度范围 | 响应 |
|----------|------|
| **< 60°C** | 正常运行 |
| **60-80°C** | 轻度降频 |
| **80-100°C** | 中度降频 |
| **100-110°C** | 重度降频 |
| **> 110°C** | 热关断保护 |

---

## 9. 安全机制

### 9.1 安全特性

| 特性 | 实现 | ASIL 等级 |
|------|------|-----------|
| **电压监控** | 多点监测 | ASIL-D |
| **温度保护** | 多级阈值 | ASIL-D |
| **过流保护** | 电流监测 | ASIL-D |
| **看门狗** | 独立看门狗 | ASIL-D |
| **电源序列监控** | 时序检查 | ASIL-B |

### 9.2 故障处理

| 故障 | 检测方法 | 响应策略 |
|------|----------|----------|
| **过压** | 电压监测 | 立即关断 |
| **欠压** | 电压监测 | 系统复位 |
| **过流** | 电流监测 | 降频/关断 |
| **过温** | 温度传感 | 降频/关断 |
| **看门狗超时** | 定时器 | 系统复位 |

---

## 10. 验证计划

### 10.1 验证目标

| 验证类型 | 覆盖率目标 | 工具 |
|----------|------------|------|
| **功能覆盖率** | 100% | UVM |
| **时序验证** | 电源序列 | 仿真 |
| **功耗验证** | 目标达成 | PowerArtist |
| **形式验证** | 安全逻辑 | JasperGold |

### 10.2 验证用例

| 用例类别 | 用例数 | 说明 |
|----------|--------|------|
| **电源序列测试** | 50+ | 上电/下电序列 |
| **DVFS 测试** | 30+ | 频率电压调节 |
| **低功耗测试** | 50+ | 各模式切换 |
| **异常测试** | 50+ | 故障注入测试 |

---

## 11. 交付物和时间表

| 交付物 | 截止日期 | 状态 |
|--------|----------|------|
| 电源管理架构规格 | 2026-02-28 | 进行中 |
| PMU 设计 | 2026-04-15 | 未开始 |
| DVFS 实现 | 2026-05-15 | 未开始 |
| RTL 代码冻结 | 2026-06-30 | 未开始 |
| DV 验证通过 | 2026-09-30 | 未开始 |

---

## 12. 审批

| 角色 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| Power 架构师 | [待确认] | - | - |
| 首席架构师 | [待确认] | - | - |
| 项目经理 | [待确认] | - | - |

---

**文档版本**: V1.0  
**最后更新**: 2026-01-19  
**状态**: 草稿  
**下一步**: 开始 RTL 代码开发

---
*本规格书作为电源管理架构详细设计的指导文件。*