# 摇光(YaoGuang) SoC 外设子系统架构规格

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | V1.0 |
| 创建日期 | 2026-01-19 |
| 最后更新 | 2026-01-19 |
| 状态 | 草稿 |
| 负责人 | 外设架构师 |
| 关联文档 | 架构规格书 (01_Architecture_Spec_YaoGuang_SoC.md) |

---

## 1. 概述

### 1.1 外设子系统设计目标

| 指标 | 目标值 | 备注 |
|------|--------|------|
| **外设接口** | 30+ 种 | 车载/消费级 |
| **带宽需求** | 64 GB/s | 高速外设总计 |
| **功耗预算** | ≤ 3W | 外设子系统 |
| **面积预算** | ≤ 8 mm² | 约占 7% |
| **安全等级** | ASIL-B/QM | 按接口分类 |

### 1.2 外设分类

| 类别 | 接口数量 | 带宽 | 安全等级 |
|------|----------|------|----------|
| **高速外设** | PCIe, USB, Ethernet | 64 GB/s | ASIL-B |
| **车载外设** | CAN, LIN, FlexRay | 1 GB/s | ASIL-B |
| **低速外设** | GPIO, I2C, SPI, UART | 100 MB/s | QM |
| **显示外设** | HDMI, DP | 16 GB/s | QM |
| **音频外设** | I2S, TDM | 1 GB/s | QM |

---

## 2. 外设架构

### 2.1 系统架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           外设子系统架构                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    APB4 Bridge (低速)                           │   │
│  │  - 32-bit 位宽                                                   │   │
│  │  - 500 MHz                                                      │   │
│  │  - GPIO, UART, I2C, SPI, Timer, Watchdog                       │   │
│  └────────────────────────────┬────────────────────────────────────┘   │
│                               │                                          │
│                               ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    AHB Bridge (中速)                            │   │
│  │  - 64-bit 位宽                                                   │   │
│  │  - 500 MHz                                                      │   │
│  │  - CAN, Audio, Crypto                                           │   │
│  └────────────────────────────┬────────────────────────────────────┘   │
│                               │                                          │
│                               ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    AXI Bridge (高速)                            │   │
│  │  - 256-bit 位宽                                                  │   │
│  │  - 1.0 GHz                                                      │   │
│  │  - PCIe, USB, Ethernet, Display                                 │   │
│  └────────────────────────────┬────────────────────────────────────┘   │
│                               │                                          │
│                               ▼                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    NoC Interface                                │   │
│  │  - 连接到系统 NoC                                               │   │
│  │  - 64 GB/s 带宽                                                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 高速外设

### 3.1 PCIe Gen4 控制器

| 参数 | 规格 |
|------|------|
| **标准** | PCI Express Base Spec 4.0 |
| **通道数** | x8 + x4 |
| **数据速率** | 16 GT/s/lane |
| **带宽** | 16 GB/s (x8) + 8 GB/s (x4) |
| **SR-IOV** | 支持 (最大 64 VF) |
| **ATS** | 支持 (地址转换服务) |

### 3.2 USB 3.2 控制器

| 参数 | 规格 |
|------|------|
| **标准** | USB 3.2 Gen2 |
| **速率** | 10 Gbps |
| **端口数** | 4-6 ports |
| **协议** | SuperSpeed+ |
| **BC 1.2** | 支持 (5V/1.5A) |
| **PD** | 支持 (USB Power Delivery) |

### 3.3 Ethernet 控制器

| 参数 | 规格 |
|------|------|
| **标准** | IEEE 802.3 |
| **速率** | 10 Gbps / 1 Gbps |
| **TSN** | 支持 (802.1Qbv, 802.1AS) |
| **MAC** | 10GBASE-R / 1000BASE-T |
| **PHY 接口** | XGMII / RGMII |

---

## 4. 车载外设

### 4.1 CAN FD 控制器

| 参数 | 规格 |
|------|------|
| **标准** | ISO 11898-2 (CAN FD) |
| **端口数** | 8-16 ports |
| **速率** | 5 Mbps (数据阶段) |
| **CAN-FD** | 支持 (64-byte 帧) |
| **CAN XL** | 可选支持 |
| **ISO 26262** | ASIL-B 支持 |

### 4.2 LIN 控制器

| 参数 | 规格 |
|------|------|
| **标准** | LIN 2.2 / ISO 17987 |
| **端口数** | 8-16 ports |
| **速率** | 20 kbps |
| **主/从** | 支持 |

### 4.3 FlexRay 控制器

| 参数 | 规格 |
|------|------|
| **标准** | ISO 17456 |
| **端口数** | 2-4 ports |
| **速率** | 10 Mbps |
| **通道** | 2 通道 |

---

## 5. 低速外设

### 5.1 GPIO 控制器

| 参数 | 规格 |
|------|------|
| **数量** | 64-128 pins |
| **方向** | 可配置输入/输出 |
| **中断** | 支持 (边沿/电平) |
| **上拉/下拉** | 可配置 |
| **驱动能力** | 2-16 mA |

### 5.2 UART 控制器

| 参数 | 规格 |
|------|------|
| **数量** | 4-8 ports |
| **波特率** | up to 10 Mbps |
| **FIFO** | 16-byte TX/RX |
| **流控** | RTS/CTS |

### 5.3 SPI 控制器

| 参数 | 规格 |
|------|------|
| **数量** | 4-8 ports |
| **速率** | up to 100 MHz |
| **模式** | 0-3 |
| **片选** | 4 CS pins/port |

### 5.4 I2C 控制器

| 参数 | 规格 |
|------|------|
| **数量** | 8-16 ports |
| **速率** | 100 kHz / 400 kHz / 1 MHz |
| **地址** | 7-bit / 10-bit |
| **SMBus** | 支持 |

### 5.5 Timer / Watchdog

| 参数 | 规格 |
|------|------|
| **Timer 数量** | 8-16 |
| **分辨率** | 32-bit |
| **看门狗** | 独立看门狗 |
| **窗口模式** | 支持 |

---

## 6. 显示接口

### 6.1 HDMI 2.0 控制器

| 参数 | 规格 |
|------|------|
| **标准** | HDMI 2.0 |
| **分辨率** | 4K @ 60Hz |
| **带宽** | 18 Gbps |
| **HDCP** | 支持 (2.3) |
| **Audio** | ARC/eARC |

### 6.2 DisplayPort 1.4 控制器

| 参数 | 规格 |
|------|------|
| **标准** | DP 1.4 |
| **分辨率** | 8K @ 60Hz |
| **带宽** | 32.4 Gbps |
| **DSC** | 支持 (Display Stream Compression) |

---

## 7. 音频接口

### 7.1 I2S / TDM 控制器

| 参数 | 规格 |
|------|------|
| **通道数** | 4-8 I2S 或 TDM |
| **采样率** | up to 192 kHz |
| **位宽** | 16/24/32-bit |
| **主/从** | 可配置 |

### 7.2 Audio DSP

| 参数 | 规格 |
|------|------|
| **算力** | 1 GOPS |
| **存储器** | 512 KB SRAM |
| **接口** | I2S / TDM |

---

## 8. 安全外设

### 8.1 Crypto 引擎

| 参数 | 规格 |
|------|------|
| **算法** | AES-256, SHA-256/384/512, RSA-4096, ECC |
| **密钥存储** | 专用安全存储 |
| **TRNG** | 真随机数发生器 |
| **PUF** | 物理不可克隆函数 |

### 8.2 安全模块

| 参数 | 规格 |
|------|------|
| **Secure Boot** | 支持 |
| **Secure Debug** | 支持 |
| **OTP** | 4 KB |
| **Key Ladder** | 3 级 |

---

## 9. 性能分析

### 9.1 带宽分配

| 外设 | 峰值带宽 | 典型带宽 | 优先级 |
|------|----------|----------|--------|
| **PCIe x8** | 16 GB/s | 8 GB/s | 高 |
| **PCIe x4** | 8 GB/s | 4 GB/s | 中 |
| **USB 3.2** | 10 GB/s | 5 GB/s | 中 |
| **10G Ethernet** | 10 GB/s | 5 GB/s | 高 |
| **Display** | 16 GB/s | 8 GB/s | 中 |
| **其他外设** | 1 GB/s | 0.1 GB/s | 低 |

### 9.2 延迟分析

| 外设 | 典型延迟 | 最大延迟 | 备注 |
|------|----------|----------|------|
| **PCIe** | 1 μs | 10 μs | 取决于负载 |
| **USB** | 2 μs | 20 μs | 取决于设备 |
| **Ethernet** | 1 μs | 10 μs | TSN 保证 |
| **CAN** | 100 μs | 500 μs | 取决于配置 |
| **UART** | 1 ms | 10 ms | 取决于波特率 |

---

## 10. 功耗分析

### 10.1 功耗预算

| 模块 | 动态功耗 (W) | 静态功耗 (W) | 峰值功耗 (W) |
|------|--------------|--------------|--------------|
| **PCIe** | 0.8 | 0.1 | 0.9 |
| **USB** | 0.4 | 0.05 | 0.45 |
| **Ethernet** | 0.5 | 0.05 | 0.55 |
| **Display** | 0.3 | 0.05 | 0.35 |
| **CAN/LIN** | 0.2 | 0.05 | 0.25 |
| **低速外设** | 0.3 | 0.1 | 0.4 |
| **Audio** | 0.1 | 0.02 | 0.12 |
| **桥接逻辑** | 0.2 | 0.05 | 0.25 |
| **时钟树** | 0.1 | 0.03 | 0.13 |
| **总计** | **2.9** | **0.46** | **3.36** |

---

## 11. 面积分析

### 11.1 面积预算

| 模块 | 面积 (mm²) | 占比 |
|------|------------|------|
| **PCIe** | 2.0 | 25% |
| **USB** | 1.0 | 13% |
| **Ethernet** | 1.2 | 15% |
| **Display** | 0.8 | 10% |
| **CAN/LIN** | 0.6 | 8% |
| **低速外设** | 1.0 | 13% |
| **Audio** | 0.5 | 6% |
| **桥接逻辑** | 0.5 | 6% |
| **其他** | 0.4 | 5% |
| **总计** | **8.0** | **100%** |

---

## 12. 安全机制

### 12.1 安全特性

| 特性 | 支持 | ASIL 等级 |
|------|------|-----------|
| **访问控制** | 基于地址 | ASIL-B |
| **中断过滤** | 支持 | ASIL-B |
| **DMA 保护** | 支持 | ASIL-B |
| **Crypto** | AES/SHA | ASIL-B |
| **Secure Boot** | 支持 | ASIL-D |

---

## 13. 验证计划

### 13.1 验证目标

| 验证类型 | 覆盖率目标 | 工具 |
|----------|------------|------|
| **功能覆盖率** | 100% | UVM |
| **协议一致性** | 100% | VIP |
| **性能验证** | 目标达成 | 仿真 |

### 13.2 验证用例

| 用例类别 | 用例数 | 说明 |
|----------|--------|------|
| **协议测试** | 300+ | 各协议测试 |
| **功能测试** | 200+ | 功能验证 |
| **异常测试** | 100+ | 错误注入 |

---

## 14. 交付物和时间表

| 交付物 | 截止日期 | 状态 |
|--------|----------|------|
| 外设架构规格 | 2026-02-28 | 进行中 |
| 高速外设设计 | 2026-04-15 | 未开始 |
| 车载外设设计 | 2026-05-15 | 未开始 |
| RTL 代码冻结 | 2026-07-31 | 未开始 |
| DV 验证通过 | 2026-10-31 | 未开始 |

---

## 15. 审批

| 角色 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| 外设架构师 | [待确认] | - | - |
| 首席架构师 | [待确认] | - | - |
| 项目经理 | [待确认] | - | - |

---

**文档版本**: V1.0  
**最后更新**: 2026-01-19  
**状态**: 草稿  
**下一步**: 开始 RTL 代码开发

---
*本规格书作为外设子系统详细设计的指导文件。*