# 摇光(YaoGuang) SoC 顶层架构规格

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | V1.0 |
| 创建日期 | 2026-01-18 |
| 最后更新 | 2026-01-18 |
| 状态 | 已批准 |
| 负责人 | 首席架构师 |
| 关联文档 | 01_Architecture_Spec_YaoGuang_SoC.md |

---

## 1. SoC 系统框图

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                              YaoGuang SoC 顶层架构                                            │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                            外部接口 (Package Pins)                                    │   │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │   │
│  │  │  LPDDR5  │  │  PCIe    │  │   USB    │  │ Ethernet │  │   CAN    │  │  MIPI    │ │   │
│  │  │  (x32)   │  │  Gen4    │  │  3.2     │  │  10G/1G  │  │   FD     │  │  CSI-2   │ │   │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────────────────────┘   │
│                                          │                                                   │
│                                          ▼                                                   │
│  ┌─────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                           IO 复用与引脚控制 (Pin Mux)                                 │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────────┐    │   │
│  │  │  GPIO 128-bit | I2C x8 | SPI x8 | UART x8 | JTAG/SWD | Display (HDMI/DP)    │    │   │
│  │  └─────────────────────────────────────────────────────────────────────────────┘    │   │
│  └─────────────────────────────────────────────────────────────────────────────────────┘   │
│                                          │                                                   │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                           电源域与时钟复位管理 (Power, Clock, Reset)                          │
│  ┌─────────────────────────────────────────────────────────────────────────────────────┐   │
│  │  PMU (电源管理单元)     |    PLL Cluster    |    复位控制器    |    时钟门控         │   │
│  │  - 电源门控开关         |    - PLL_MAIN     |    - POR         |    - CPU CG        │   │
│  │  - DVFS 控制            |    - PLL_DDR      |    - Warm Reset  |    - NPU CG        │   │
│  │  - 功耗监测             |    - PLL_PERI     |    - 看门狗      |    - Peripherals   │   │
│  │  - 电源序列             |    - PLL_USB      |    - 安全复位    |                     │   │
│  └─────────────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
                                          │
          ┌───────────────────────────────┼───────────────────────────────┐
          ▼                               ▼                               ▼
┌─────────────────────┐     ┌─────────────────────┐     ┌─────────────────────┐
│   PD_CPU (1.0V)     │     │   PD_SAFETY (1.0V)  │     │   PD_NPU (1.0V)     │
│  ┌───────────────┐  │     │  ┌───────────────┐  │     │  ┌───────────────┐  │
│  │ CPU Cluster   │  │     │  │ Safety Island │  │     │  │ NPU Cluster   │  │
│  │ 8x Cortex-A78 │  │     │  │ 2x Cortex-R52 │  │     │  │ 4x Clusters   │  │
│  │ ACE4 Interface│  │     │  │ Lockstep      │  │     │  │ AXI4 Interface│  │
│  │ L1/L2 Cache   │  │     │  │ ECC Memory    │  │     │  │ SRAM Banks    │  │
│  └───────────────┘  │     │  │ Safety Monitors│ │     │  └───────────────┘  │
└─────────────────────┘     │  └───────────────┘  │     └─────────────────────┘
                            └─────────────────────┘                │
                                  │                               │
                                  │                               │
                                  ▼                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                              NoC 互联矩阵 (Network-on-Chip)                                   │
│  ┌─────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                          Crossbar Switch (64-port, 512-bit)                          │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │   │
│  │  │CPU Cluster│ │NPU Cluster│ │   GPU    │ │   ISP   │ │Safety Isl│ │  L3      │           │   │
│  │  │  (ACE4)  │ │  (AXI4)  │ │  (ACE4)  │ │ (AXI4)  │ │ (AXI4)  │ │ Cache    │           │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘           │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │   │
│  │  │Mem Ctrl │ │  PCIe   │ │  USB    │ │Ethernet │ │  CAN    │ │Display  │           │   │
│  │  │ (AXI4)  │ │  (AXI4) │ │  (AXI4) │ │ (AXI4)  │ │ (AXI4)  │ │ (AXI4)  │           │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘           │   │
│  └─────────────────────────────────────────────────────────────────────────────────────┘   │
│  - QoS 服务质量 (4级优先级)    |    - 虚拟通道 (4 VCs)    |    - 路由算法 (XY/自适应)      │
│  - 一致性支持 (ACE4)          |    - 流量控制 (Credit)   |    - 错误检测 (ECC/CRC)       │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                              存储器子系统 (Memory Subsystem)                                  │
│  ┌─────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                          LPDDR5 控制器 (32-bit, 6400 MT/s)                           │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────────┐    │   │
│  │  │  - DDR PHY (1600 MHz) | 调度器 | ECC 校验 | 命令队列 | 读写缓冲              │    │   │
│  │  └─────────────────────────────────────────────────────────────────────────────┘    │   │
│  │                          系统缓存 (L3 Cache, 8 MB)                                  │   │
│  │  ┌─────────────────────────────────────────────────────────────────────────────┐    │   │
│  │  │  - 16路组相联 | 8 MB | ACE4 接口 | 写回策略 | 替换算法 (LRU)                 │    │   │
│  │  └─────────────────────────────────────────────────────────────────────────────┘    │   │
│  └─────────────────────────────────────────────────────────────────────────────────────┘   │
│                                          │                                                   │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                              外设子系统 (Peripheral Subsystem)                                │
│  ┌─────────────────────────────────────────────────────────────────────────────────────┐   │
│  │                          APB4 外设总线 (32-bit, 100 MHz)                             │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │   │
│  │  │   PMU   │ │  Crypto │ │   I2C   │ │   SPI   │ │  GPIO   │ │  Timer  │           │   │
│  │  │ (AXI-APB)│ │ (AXI4)  │ │  x4     │ │  x4     │ │ 128-bit │ │  Watch  │           │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘           │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐                       │   │
│  │  │  Audio  │ │  CAN    │ │   UART  │ │  Debug  │ │  RTC    │                       │   │
│  │  │ I2S/TDM │ │  x8     │ │  x8     │ │ JTAG/SWD│ │ 32KHz   │                       │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘                       │   │
│  └─────────────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 模块互联矩阵 (NoC 连接)

### 2.1 NoC 端口定义

| 端口号 | Master/Slave | 模块 | 接口协议 | 数据位宽 | 带宽需求 | 优先级 |
|--------|--------------|------|----------|----------|----------|--------|
| 0-7 | Master | 8x Cortex-A78AE | ACE4 | 512-bit | 64 GB/s | 高 (QoS 3) |
| 8-9 | Master | 2x Cortex-R52 | AXI4 | 256-bit | 32 GB/s | 最高 (QoS 3) |
| 10-13 | Master | 4x NPU Cluster | AXI4 | 512-bit | 200 GB/s | 高 (QoS 3) |
| 14 | Master | GPU Cluster | ACE4 | 512-bit | 64 GB/s | 中 (QoS 2) |
| 15 | Master | ISP | AXI4 | 256-bit | 32 GB/s | 中 (QoS 2) |
| 16 | Master | Safety Island | AXI4 | 256-bit | 16 GB/s | 高 (QoS 3) |
| 17 | Slave | L3 Cache | ACE4 | 512-bit | 128 GB/s | 高 (QoS 3) |
| 18 | Master/Slave | LPDDR5 MC | AXI4 | 512-bit | 200 GB/s | 高 (QoS 3) |
| 19 | Master | PCIe x8 | AXI4 | 256-bit | 32 GB/s | 中 (QoS 2) |
| 20 | Master | PCIe x4 | AXI4 | 128-bit | 16 GB/s | 中 (QoS 2) |
| 21 | Master | USB 3.2 | AXI4 | 128-bit | 10 GB/s | 低 (QoS 1) |
| 22 | Master | Ethernet 10G | AXI4 | 256-bit | 16 GB/s | 中 (QoS 2) |
| 23 | Master | Ethernet 1G | AXI4 | 64-bit | 2 GB/s | 低 (QoS 1) |
| 24 | Master | Display | AXI4 | 128-bit | 16 GB/s | 中 (QoS 2) |
| 25 | Master | Crypto | AXI4 | 128-bit | 8 GB/s | 低 (QoS 1) |
| 26 | Master | CAN FD x8 | APB4 | 32-bit | 1 GB/s | 低 (QoS 0) |
| 27 | Master | I2C/SPI/GPIO | APB4 | 32-bit | 1 GB/s | 低 (QoS 0) |
| 28 | Master | Audio | AXI4 | 64-bit | 4 GB/s | 低 (QoS 1) |
| 29 | Master | PMU | APB4 | 32-bit | 0.1 GB/s | 低 (QoS 0) |
| 30 | Slave | Boot ROM | AXI4 | 64-bit | 2 GB/s | 高 (QoS 3) |
| 31 | Slave | Debug | JTAG/SWD | - | - | 中 (QoS 2) |

### 2.2 虚拟通道配置

| VC 编号 | 优先级 | 流量类别 | 服务质量目标 |
|---------|--------|----------|--------------|
| VC0 | 最高 (3) | 安全关键流量 (Safety Island, CPU 指令) | 延迟 < 10 cycles |
| VC1 | 高 (2) | 实时流量 (NPU 数据, GPU 渲染) | 延迟 < 30 cycles |
| VC2 | 中 (1) | 大块数据传输 (DMA, 内存拷贝) | 带宽保证 |
| VC3 | 低 (0) | 尽力而为 (调试, 低优先级外设) | Best Effort |

### 2.3 QoS 策略

| 流量类型 | 优先级 | 带宽保证 | 延迟上限 |
|----------|--------|----------|----------|
| Safety Island 流量 | P3 | 10% | < 10 cycles |
| CPU 指令/数据缓存 | P3 | 30% | < 20 cycles |
| NPU 数据传输 | P3 | 40% | < 50 cycles |
| GPU 渲染数据 | P2 | 15% | < 40 cycles |
| 外设 DMA | P1 | 10% | < 100 cycles |
| 调试流量 | P0 | 5% | Best Effort |

---

## 3. 地址映射 (Memory Map)

### 3.1 地址空间概览

| 地址范围 | 大小 | 区域 | 访问权限 | 描述 |
|----------|------|------|----------|------|
| 0x0000_0000 - 0x0FFF_FFFF | 256 MB | Boot ROM | R-X | Boot ROM (安全启动) |
| 0x1000_0000 - 0x1FFF_FFFF | 256 MB | Safety Island | R/W | 安全岛本地 SRAM |
| 0x2000_0000 - 0x2FFF_FFFF | 256 MB | NPU Cluster 0 | R/W | NPU Cluster 0 控制与数据 |
| 0x3000_0000 - 0x3FFF_FFFF | 256 MB | NPU Cluster 1 | R/W | NPU Cluster 1 控制与数据 |
| 0x4000_0000 - 0x4FFF_FFFF | 256 MB | NPU Cluster 2 | R/W | NPU Cluster 2 控制与数据 |
| 0x5000_0000 - 0x5FFF_FFFF | 256 MB | NPU Cluster 3 | R/W | NPU Cluster 3 控制与数据 |
| 0x6000_0000 - 0x6FFF_FFFF | 256 MB | L3 Cache 配置 | R/W | L3 Cache 配置寄存器 |
| 0x7000_0000 - 0x7FFF_FFFF | 256 MB | GPU | R/W | GPU 控制与显存 |
| 0x8000_0000 - 0x8FFF_FFFF | 256 MB | ISP | R/W | ISP 控制与图像缓冲 |
| 0x9000_0000 - 0x9FFF_FFFF | 256 MB | Display | R/W | 显示控制器 |
| 0xA000_0000 - 0xAFFF_FFFF | 256 MB | Crypto | R/W | 加密/解密引擎 |
| 0xB000_0000 - 0xBFFF_FFFF | 256 MB | PCIe x8 | R/W | PCIe x8 配置空间 |
| 0xC000_0000 - 0xCFFF_FFFF | 256 MB | PCIe x4 | R/W | PCIe x4 配置空间 |
| 0xD000_0000 - 0xDFFF_FFFF | 256 MB | USB 3.2 | R/W | USB 控制器 |
| 0xE000_0000 - 0xEFFF_FFFF | 256 MB | Ethernet | R/W | 10G/1G Ethernet |
| 0xF000_0000 - 0xF0FF_FFFF | 16 MB | 系统外设 (APB) | R/W | 系统外设基地址 |
| 0xF100_0000 - 0xF1FF_FFFF | 16 MB | PMU | R/W | 电源管理单元 |
| 0xF200_0000 - 0xF2FF_FFFF | 16 MB | Clock/Reset | R/W | 时钟复位控制 |
| 0xF300_0000 - 0xF3FF_FFFF | 16 MB | 错误报告 | R/W | 错误检测与报告 |
| 0xF400_0000 - 0xF4FF_FFFF | 16 MB | 调试 | R/W | 调试控制器 |
| 0xF500_0000 - 0xF5FF_FFFF | 16 MB | 中断控制器 | R/W | GIC/中断聚合器 |
| 0xF600_0000 - 0xF6FF_FFFF | 16 MB | 定时器 | R/W | 系统定时器 |
| 0xF700_0000 - 0xF7FF_FFFF | 16 MB | Watchdog | R/W | 看门狗定时器 |
| 0xF800_0000 - 0xF8FF_FFFF | 16 MB | RTC | R/W | 实时时钟 |
| 0xF900_0000 - 0xF9FF_FFFF | 16 MB | GPIO | R/W | 通用 I/O |
| 0xFA00_0000 - 0xFAFF_FFFF | 16 MB | I2C x4 | R/W | I2C 控制器 |
| 0xFB00_0000 - 0xFBFF_FFFF | 16 MB | SPI x4 | R/W | SPI 控制器 |
| 0xFC00_0000 - 0xFCFF_FFFF | 16 MB | UART x8 | R/W | UART 控制器 |
| 0xFD00_0000 - 0xFDFF_FFFF | 16 MB | CAN FD x8 | R/W | CAN FD 控制器 |
| 0xFE00_0000 - 0xFEFF_FFFF | 16 MB | Audio | R/W | 音频控制器 |
| 0xFF00_0000 - 0xFFFF_FFFF | 256 MB | LPDDR5 控制器 | R/W | DDR 控制器配置 |

### 3.2 外设子系统地址映射 (APB 总线)

| 偏移地址 | 大小 | 外设 | 描述 |
|----------|------|------|------|
| 0x0000 - 0x0FFF | 4 KB | PMU | 电源管理单元寄存器 |
| 0x1000 - 0x1FFF | 4 KB | Clock/Reset | 时钟复位控制寄存器 |
| 0x2000 - 0x2FFF | 4 KB | Error Report | 错误报告寄存器 |
| 0x3000 - 0x3FFF | 4 KB | Debug | 调试控制寄存器 |
| 0x4000 - 0x4FFF | 4 KB | GIC | 中断控制器寄存器 |
| 0x5000 - 0x5FFF | 4 KB | System Timer | 系统定时器 |
| 0x6000 - 0x6FFF | 4 KB | Watchdog | 看门狗定时器 |
| 0x7000 - 0x7FFF | 4 KB | RTC | 实时时钟 |
| 0x8000 - 0x8FFF | 4 KB | GPIO | GPIO 寄存器 |
| 0x9000 - 0x9FFF | 4 KB | I2C_0 | I2C 控制器 0 |
| 0xA000 - 0xAFFF | 4 KB | I2C_1 | I2C 控制器 1 |
| 0xB000 - 0xBFFF | 4 KB | I2C_2 | I2C 控制器 2 |
| 0xC000 - 0xCFFF | 4 KB | I2C_3 | I2C 控制器 3 |
| 0xD000 - 0xDFFF | 4 KB | SPI_0 | SPI 控制器 0 |
| 0xE000 - 0xEFFF | 4 KB | SPI_1 | SPI 控制器 1 |
| 0xF000 - 0xFFFF | 4 KB | SPI_2 | SPI 控制器 2 |

---

## 4. 时钟树架构

### 4.1 时钟域定义

| 时钟域 | 频率 | 来源 | 驱动模块 | 功耗预算 |
|--------|------|------|----------|----------|
| **clk_core** | 1.5-2.0 GHz | PLL_MAIN | CPU 集群 (8x A78AE) | 1.2 W |
| **clk_safety** | 1.0-1.5 GHz | PLL_MAIN | 安全岛 (2x R52) | 0.3 W |
| **clk_npu** | 1.5-2.0 GHz | PLL_MAIN | NPU 集群 (4x) | 1.5 W |
| **clk_gpu** | 1.0-1.5 GHz | PLL_MAIN | GPU 集群 | 0.5 W |
| **clk_isp** | 800 MHz | PLL_MAIN | ISP | 0.2 W |
| **clk_noc** | 2.0 GHz | PLL_MAIN | NoC 互联 | 0.6 W |
| **clk_mem** | 1.6 GHz | PLL_DDR | DDR 控制器 | 0.4 W |
| **clk_sys** | 500 MHz | PLL_PERI | APB 外设总线 | 0.2 W |
| **clk_usb** | 480 MHz | PLL_USB | USB 控制器 | 0.1 W |
| **clk_pcie** | 250 MHz | PLL_PCIE | PCIe 控制器 | 0.1 W |
| **clk_eth** | 312.5 MHz | PLL_ETH | Ethernet | 0.1 W |
| **clk_rtc** | 32.768 kHz | RTC 晶体 | RTC | 0.001 W |

### 4.2 PLL 配置

| PLL | 输入频率 | 输出频率 | 相位噪声 | 用途 |
|-----|----------|----------|----------|------|
| **PLL_MAIN** | 24 MHz | 0.5-2.5 GHz | < -100 dBc/Hz | CPU/NPU/GPU/ISP/NoC |
| **PLL_DDR** | 24 MHz | 0.4-2.0 GHz | < -110 dBc/Hz | DDR 控制器 |
| **PLL_PERI** | 24 MHz | 50-500 MHz | < -90 dBc/Hz | 系统外设 |
| **PLL_USB** | 24 MHz | 480 MHz | < -80 dBc/Hz | USB |
| **PLL_PCIE** | 24 MHz | 100-500 MHz | < -85 dBc/Hz | PCIe |
| **PLL_ETH** | 24 MHz | 312.5 MHz | < -85 dBc/Hz | Ethernet |

### 4.3 时钟门控策略

| 模块 | 门控类型 | 节省功耗 | 控制方式 |
|------|----------|----------|----------|
| CPU Core | 自动门控 | 30-40% | 硬件空闲检测 |
| NPU Cluster | 自动门控 | 20-30% | 硬件空闲检测 |
| GPU | 自动门控 | 15-25% | 硬件空闲检测 |
| L2/L3 Cache | 自动门控 | 10-20% | Bank 级门控 |
| NoC | 自动门控 | 10-15% | 端口级门控 |
| 外设 | 软件门控 | 30-50% | PMU 控制 |

---

## 5. 复位策略

### 5.1 复位域定义

| 复位域 | 类型 | 同步/异步 | 释放顺序 | 驱动模块 |
|--------|------|-----------|----------|----------|
| **rst_por_n** | POR | 异步 | 0 (最先) | POR 电路 |
| **rst_core_n** | 热复位 | 同步 | 1 | CPU 集群 |
| **rst_safety_n** | 安全复位 | 同步 | 1 | 安全岛 |
| **rst_npu_n** | 热复位 | 同步 | 2 | NPU 集群 |
| **rst_gpu_n** | 热复位 | 同步 | 2 | GPU 集群 |
| **rst_isp_n** | 热复位 | 同步 | 2 | ISP |
| **rst_noc_n** | 热复位 | 同步 | 2 | NoC |
| **rst_mem_n** | 热复位 | 同步 | 3 | 存储器控制器 |
| **rst_sys_n** | 热复位 | 同步 | 3 | 系统外设 |
| **rst_pcie_n** | 热复位 | 同步 | 3 | PCIe |
| **rst_usb_n** | 热复位 | 同步 | 3 | USB |
| **rst_eth_n** | 热复位 | 同步 | 3 | Ethernet |

### 5.2 复位类型

| 复位类型 | 触发源 | 传播范围 | 用途 |
|----------|--------|----------|------|
| **POR** | 电源监测 | 全芯片 | 上电复位 |
| **Warm Reset** | 软件/看门狗 | 全芯片 (除 Safety) | 系统热复位 |
| **Core Reset** | 软件/看门狗 | 单核 | CPU 核复位 |
| **Debug Reset** | 调试器 | 调试逻辑 | 调试复位 |
| **Safety Reset** | 安全监测 | 安全岛 | 安全岛独立复位 |
| **Peripheral Reset** | 软件 | 单个外设 | 外设复位 |

### 5.3 复位时序要求

| 参数 | 最小值 | 最大值 | 描述 |
|------|--------|--------|------|
| POR 脉冲宽度 | 10 ms | - | POR 保持时间 |
| 复位释放序列间隔 | 100 cycles | - | 各域释放间隔 |
| 复位到时钟启动 | 5 cycles | - | 时钟启动延迟 |
| 软件复位脉冲 | 10 cycles | - | 软件复位宽度 |

---

## 6. 电源域划分

### 6.1 电源域定义

| 电源域 | 电压 | 时钟域 | 复位域 | 电源门控 | 保留寄存器 |
|--------|------|--------|--------|----------|------------|
| **PD_ALWAYS_ON** | 0.8V | clk_rtc | rst_por_n | 不支持 | RTC 寄存器 |
| **PD_CPU** | 0.65-0.9V | clk_core | rst_core_n | 支持 | CPU 状态寄存器 |
| **PD_SAFETY** | 0.8V | clk_safety | rst_safety_n | 支持 | Safety 状态寄存器 |
| **PD_NPU** | 0.65-0.9V | clk_npu | rst_npu_n | 支持 | NPU 状态寄存器 |
| **PD_GPU** | 0.65-0.85V | clk_gpu | rst_gpu_n | 支持 | GPU 状态寄存器 |
| **PD_ISP** | 0.7-0.85V | clk_isp | rst_isp_n | 支持 | ISP 状态寄存器 |
| **PD_NOC** | 0.8V | clk_noc | rst_noc_n | 支持 | NoC 状态寄存器 |
| **PD_MEM** | 0.8V | clk_mem | rst_mem_n | 不支持 | DDR 配置寄存器 |
| **PD_SYS** | 0.8V | clk_sys | rst_sys_n | 支持 | 系统配置寄存器 |
| **PD_PCIE** | 0.8V | clk_pcie | rst_pcie_n | 支持 | PCIe 配置寄存器 |
| **PD_USB** | 0.8V | clk_usb | rst_usb_n | 支持 | USB 配置寄存器 |
| **PD_ETH** | 0.8V | clk_eth | rst_eth_n | 支持 | Ethernet 配置寄存器 |

### 6.2 功耗预算

| 电源域 | 动态功耗 (W) | 静态功耗 (W) | 峰值功耗 (W) | 占比 |
|--------|--------------|--------------|--------------|------|
| PD_CPU | 12-15 | 1.5 | 18 | 30% |
| PD_NPU | 20-25 | 2.0 | 30 | 40% |
| PD_GPU | 5-7 | 0.5 | 8 | 12% |
| PD_MEM | 5-6 | 0.5 | 7 | 10% |
| PD_NOC | 2-3 | 0.3 | 4 | 5% |
| PD_SYS | 1-2 | 0.2 | 3 | 3% |
| **总计** | **45-58** | **5.0** | **70** | 100% |

### 6.3 电源状态

| 状态 | 电压 | 时钟 | 复位 | 功耗 |
|------|------|------|------|------|
| **ON** | 额定电压 | 运行 | 释放 | 100% |
| **RETENTION** | 最低保持电压 | 关闭 | 断言 | 10% |
| **OFF** | 0V | 关闭 | 断言 | 0% |

---

## 7. 引脚分配

### 7.1 引脚分类统计

| 引脚类型 | 数量 | 描述 |
|----------|------|------|
| **电源引脚** | 200+ | VDD, VSS, VDDIO, VSSIO |
| **时钟引脚** | 4 | 24 MHz 晶振, RTC 晶振 |
| **DDR 引脚** | 120 | LPDDR5 x32 数据 + 地址/控制 |
| **高速串行** | 100+ | PCIe, USB, Ethernet, MIPI |
| **GPIO** | 128 | 通用 I/O |
| **调试** | 20 | JTAG, SWD, Trace |
| **其他** | 50 | 复位, 模式选择, 电压检测 |
| **总计** | 600+ | BGA 封装 |

### 7.2 高速接口引脚

| 接口 | 引脚数 | 协议 | 备注 |
|------|--------|------|------|
| **LPDDR5** | 120 | LPDDR5 x32 | 2 通道, 32-bit |
| **PCIe x8** | 100 | PCIe Gen4 | 8 lane + 参考时钟 |
| **PCIe x4** | 60 | PCIe Gen4 | 4 lane + 参考时钟 |
| **USB 3.2** | 30 | USB 3.2 Gen2 | 4-6 ports |
| **Ethernet 10G** | 20 | XGMII | SFI 接口 |
| **Ethernet 1G** | 10 | RGMII | GMII 接口 |
| **MIPI CSI-2** | 40 | MIPI CSI-2 v2.0 | 8-16 lane |
| **HDMI 2.0** | 20 | HDMI 2.0 | TMDS |
| **DP 1.4** | 20 | DisplayPort 1.4 | Main + AUX |

### 7.3 GPIO 引脚复用

| GPIO 组 | 数量 | 可用功能 |
|---------|------|----------|
| **GPIOA** | 32 | UART, I2C, SPI, GPIO |
| **GPIOB** | 32 | CAN, PWM, GPIO |
| **GPIOC** | 32 | I2S, PWM, GPIO |
| **GPIOD** | 32 | Debug, Mode, GPIO |

---

## 8. 启动流程

### 8.1 启动阶段

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                              YaoGuang SoC 启动流程                                           │
├─────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                             │
│  Phase 0: 上电复位 (Power-On Reset)                                                         │
│  ───────────────────────────────────────────────────────────────────────────────────────  │
│  - POR 电路检测电源稳定                                                                     │
│  - 延时释放 POR_N (10ms)                                                                   │
│  - 启动 24 MHz 晶振                                                                        │
│  - PLL 锁定 (PLL_MAIN, PLL_DDR)                                                            │
│                                                                                             │
│  ▼                                                                                         │
│                                                                                             │
│  Phase 1: 早期初始化 (Early Boot)                                                           │
│  ───────────────────────────────────────────────────────────────────────────────────────  │
│  - 复位控制器初始化                                                                         │
│  - 释放 rst_sys_n (系统外设)                                                               │
│  - Boot ROM 使能                                                                            │
│  - Safety Island 启动 (锁步核)                                                              │
│                                                                                             │
│  ▼                                                                                         │
│                                                                                             │
│  Phase 2: 一级引导 (BL1 - Bootloader Stage 1)                                               │
│  ───────────────────────────────────────────────────────────────────────────────────────  │
│  - Safety Island 执行 (Cortex-R52)                                                          │
│  - 从 Boot ROM 读取 BL2 代码                                                                │
│  - 安全启动验证 (ROM Code Hash)                                                             │
│  - 初始化 PMU                                                                               │
│                                                                                             │
│  ▼                                                                                         │
│                                                                                             │
│  Phase 3: 二级引导 (BL2 - Bootloader Stage 2)                                               │
│  ───────────────────────────────────────────────────────────────────────────────────────  │
│  - DDR 控制器初始化 (LPDDR5)                                                                │
│  - DDR 训练 (Training)                                                                      │
│  - 从外部存储加载 BL3 代码                                                                  │
│  - 配置时钟 (DVFS)                                                                          │
│                                                                                             │
│  ▼                                                                                         │
│                                                                                             │
│  Phase 4: 可信执行环境 (TEE - Trusted Execution Environment)                                │
│  ───────────────────────────────────────────────────────────────────────────────────────  │
│  - 启动安全监控 (Security Monitor)                                                          │
│  - 初始化安全服务                                                                           │
│  - 启动主处理器的 EL2/EL3 模式                                                              │
│                                                                                             │
│  ▼                                                                                         │
│                                                                                             │
│  Phase 5: 操作系统加载 (BL3 - Bootloader Stage 3)                                           │
│  ───────────────────────────────────────────────────────────────────────────────────────  │
│  - 从外部存储加载 Linux/RTOS                                                                │
│  - 设备树 (Device Tree) 传递                                                               │
│  - 启动 CPU 集群 (8x A78AE)                                                                │
│  - 启动其他加速器 (NPU, GPU)                                                               │
│                                                                                             │
│  ▼                                                                                         │
│                                                                                             │
│  Phase 6: 正常运行 (Runtime)                                                                │
│  ───────────────────────────────────────────────────────────────────────────────────────  │
│  - 操作系统运行                                                                             │
│  - PMU 功耗管理                                                                             │
│  - 设备驱动初始化                                                                           │
│  - 应用执行                                                                                 │
│                                                                                             │
└─────────────────────────────────────────────────────────────────────────────────────────────┘
```

### 8.2 启动源选择

| 启动源 | 接口 | 地址 | 描述 |
|--------|------|------|------|
| **QSPI Flash** | SPI | 0x0000_0000 | 外部 SPI Flash (默认) |
| **eMMC** | SD/MMC | 0x0000_0000 | 嵌入式 eMMC |
| **NOR Flash** | QSPI | 0x0000_0000 | 外部 NOR Flash |
| **UART** | UART | - | UART 下载模式 |
| **USB** | USB | - | USB 下载模式 |

### 8.3 安全启动

| 阶段 | 安全机制 | 验证内容 |
|------|----------|----------|
| **BL1** | ROM Code | Boot ROM 代码完整性 |
| **BL2** | RSA/ECDSA | BL2 镜像签名验证 |
| **BL3** | RSA/ECDSA | Linux/RTOS 镜像签名 |
| **Runtime** | Secure Boot | 运行时完整性检查 |

---

## 9. 交付物清单

| 文件 | 路径 | 描述 |
|------|------|------|
| 架构规格 | 02_Architecture/17_SoC_Top_Architecture.md | 本文档 |
| SoC 顶层 RTL | 04_Design_RTL/soc_top/soc_top.sv | SoC 顶层模块 |
| 时钟复位 RTL | 04_Design_RTL/soc_top/soc_clock_reset.sv | 时钟复位树 |
| 电源域 RTL | 04_Design_RTL/soc_top/soc_power_domain.sv | 电源域控制 |
| 引脚复用 RTL | 04_Design_RTL/soc_top/soc_pin_mux.sv | 引脚复用 |
| 胶合逻辑 RTL | 04_Design_RTL/soc_top/soc_glue_logic.sv | 胶合逻辑 |
| Boot ROM 封装 | 04_Design_RTL/soc_top/boot_rom_wrapper.sv | Boot ROM 封装 |
| 公共包 | 04_Design_RTL/soc_top/soc_package.sv | 公共定义 |
| 地址映射 | 04_Design_RTL/soc_top/soc_address_map.sv | 地址分配 |
| 时序约束 | 04_Design_RTL/soc_top/soc_top.sdc | SoC 级约束 |
| 功能列表 | 04_Design_RTL/soc_top/FEATURE_LIST.md | CV 验证列表 |

---

## 10. 审批

| 角色 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| 首席架构师 | - | - | - |
| 项目经理 | - | - | - |
| CEO | - | - | 2026-01-18 |

---

**文档版本**: V1.0  
**最后更新**: 2026-01-18  
**状态**: 已批准

---

*本规格书作为 YaoGuang SoC 顶层集成的指导文件。*
