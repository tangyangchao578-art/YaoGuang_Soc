# 摇光(YaoGuang) SoC CPU 子系统微架构规格

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | V1.0 |
| 创建日期 | 2026-01-19 |
| 最后更新 | 2026-01-19 |
| 状态 | 草稿 |
| 负责人 | CPU 架构师 |
| 关联文档 | 架构规格书 (01_Architecture_Spec_YaoGuang_SoC.md) |

---

## 1. 概述

### 1.1 CPU 子系统组成

| 模块 | 核心数 | 架构 | 频率 | 安全等级 | 用途 |
|------|--------|------|------|---------|------|
| **应用处理器集群** | 8 核 | ARM Cortex-A78AE | 1.5-2.0 GHz | ASIL-B | 通用计算、操作系统 |
| **安全处理器集群** | 2 核 (锁步) | ARM Cortex-R52 | 1.0-1.5 GHz | ASIL-D | 安全监控、实时控制 |
| **系统缓存** | - | 统一 L3 Cache | 2.0 GHz | ASIL-B | 片上共享缓存 |

### 1.2 设计目标

| 指标 | 目标值 | 备注 |
|------|--------|------|
| 总算力 | ≥ 100K DMIPS | 8x A78AE |
| 单核性能 | ≥ 12.5K DMIPS/核 | Cortex-A78AE @2.0GHz |
| 功耗 | ≤ 15W | 应用 CPU 总功耗 |
| 面积 | ≤ 24 mm² | 约占芯片 20% |
| L1 Cache 命中率 | ≥ 95% | 优化配置 |
| L2 Cache 命中率 | ≥ 90% | 优化配置 |

---

## 2. 应用处理器集群 (Cortex-A78AE x8)

### 2.1 核心微架构

#### 2.1.1 流水线配置

| 参数 | 规格 | 说明 |
|------|------|------|
| 流水线深度 | 13 级 | 深度流水线设计 |
| 发射宽度 | 8-way 超标量 | 8 指令/周期 |
| 乱序执行 | 支持 | ROB: 256 entries |
| 分支预测 | TAGE | 高准确率预测器 |
| 投机执行 | 支持 | 错误路径恢复 |

#### 2.1.2 执行单元配置

| 单元类型 | 数量 | 功能 |
|----------|------|------|
| ALU | 4 个 | 整数运算 |
| AGU | 4 个 | 地址生成 |
| FP/ASIMD | 4 个 | 浮点/矢量运算 |
| MAC | 2 个 | 乘累加运算 |
| Ld/St | 4 个 | 加载/存储 |

#### 2.1.3 缓存配置

##### L1 Cache

| 参数 | I-Cache | D-Cache |
|------|---------|---------|
| 大小 | 64 KB | 64 KB |
| 关联度 | 4 路组相联 | 4 路组相联 |
| 块大小 | 64 Bytes | 64 Bytes |
| 替换策略 | LRU | LRU |
| 延迟 | 4 cycles | 4 cycles |
| 带宽 | 256-bit/cycle | 256-bit/cycle |
| ECC | SECDED | SECDED |
| 写策略 | 写回 | 写回 + 写分配 |

##### L2 Cache

| 参数 | 规格 |
|------|------|
| 大小 | 512 KB/核 (私有) |
| 关联度 | 8 路组相联 |
| 块大小 | 64 Bytes |
| 替换策略 | LRU |
| 延迟 | 12 cycles |
| 带宽 | 512-bit/cycle |
| ECC | SECDED |
| 写策略 | 写回 + 写分配 |
| 预取 | 支持 (2 级预取器) |

#### 2.1.4 TLB 配置

| 参数 | I-TLB | D-TLB |
|------|-------|-------|
| 条目数 | 64 | 64 |
| 关联度 | 4 路 | 4 路 |
| 页大小 | 4KB / 16KB / 64KB | 4KB / 16KB / 64KB |
| 延迟 | 1 cycle | 1 cycle |
| S2 TLB | 共享 32 entries | 共享 32 entries |

#### 2.1.5 频率与功耗管理

| 特性 | 支持 | 说明 |
|------|------|------|
| DVFS | 是 | 1.5 - 2.0 GHz |
| 时钟门控 | 是 | 模块级时钟门控 |
| 电源门控 | 是 | Core 级电源关断 |
| 热监控 | 是 | 内置温度传感器 |
| WFI/WFE | 是 | 低功耗待机 |

### 2.2 集群级配置

#### 2.2.1 ACE 接口配置

| 参数 | 规格 |
|------|------|
| 协议 | ACE4 (AXI Coherency Extensions) |
| 位宽 | 512-bit |
| 频率 | 2.0 GHz |
| 带宽 | 128 GB/s (双向) |
| 一致性 | snoop-less DVM + snoop filter |
| QoS | 支持 (4-bit QoS 信号) |

#### 2.2.2 电源管理

| 电源域 | 电压范围 | 功耗预算 |
|--------|----------|----------|
| Core 0-3 (高性能) | 0.8V - 1.0V | 6W |
| Core 4-7 (能效) | 0.7V - 0.9V | 5W |
| L2 Cache | 0.8V - 1.0V | 2W |
| SCU + 互连 | 0.8V | 1W |
| **集群总计** | - | **≤ 14W** |

#### 2.2.3 调试与跟踪

| 特性 | 支持 | 说明 |
|------|------|------|
| CoreSight | 是 | 完整调试框架 |
| ETM | 是 | 指令跟踪 |
| CTI | 是 | 触发接口 |
| ITM | 是 | 指令跟踪宏单元 |
| TMC | 是 | 跟踪内存控制器 |
| 调试端口 | 5-wire JTAG + SWD | |

---

## 3. 安全处理器集群 (Cortex-R52 Dual-Core Lockstep)

### 3.1 核心微架构

#### 3.1.1 锁步架构

```
┌─────────────────────────────────────────────────────────┐
│                    Safety Island                          │
│  ┌──────────────┐      ┌──────────────┐                 │
│  │   Core 0     │      │   Core 1     │                 │
│  │  (Primary)   │      │  (Shadow)    │                 │
│  └──────┬───────┘      └──────┬───────┘                 │
│         │                     │                          │
│         └─────────┬───────────┘                          │
│                   ▼                                      │
│         ┌─────────────────┐                              │
│         │  Lockstep       │                              │
│         │  Comparator     │                              │
│         └────────┬────────┘                              │
│                  │                                       │
│           ┌──────▼──────┐                                │
│           │   Safety    │                                │
│           │   Response  │                                │
│           │   Logic     │                                │
│           └─────────────┘                                │
└─────────────────────────────────────────────────────────┘
```

#### 3.1.2 Cortex-R52 配置

| 参数 | 规格 |
|------|------|
| 架构 | ARMv8-R AArch32/AArch64 |
| 核心数 | 2 (Dual-Core Lockstep) |
| 频率 | 1.0 - 1.5 GHz |
| 流水线 | 8 级 |
| 发射宽度 | 双发射 |
| 执行模式 | 固定优先级调度 |
| 确定性 | 支持 |
| 中断延迟 | < 10 cycles |

#### 3.1.3 存储器配置

| 存储器 | 大小 | 类型 | 延迟 | ECC |
|--------|------|------|------|-----|
| I-Cache | 32 KB/核 | 4 路组相联 | 4 cycles | SECDED |
| D-Cache | 32 KB/核 | 4 路组相联 | 4 cycles | SECDED |
| TCM | 256 KB | 紧耦合 SRAM | 1 cycle | SECDED |
| L2 Cache | 1 MB | 共享 | 12 cycles | SECDED |

### 3.2 安全机制

#### 3.2.1 锁步比较器

| 参数 | 规格 |
|------|------|
| 比较粒度 | 指令级结果比较 |
| 比较延迟 | 1 cycle |
| 错误检测 | 100% (单比特错误) |
| 响应时间 | < 5 cycles |
| 错误记录 | 32-bit 错误码 |

#### 3.2.2 ECC 保护

| 存储器 | ECC 宽度 | 检测能力 | 纠正能力 |
|--------|----------|----------|----------|
| Cache | 8-bit SECDED | 2-bit | 1-bit |
| TCM | 8-bit SECDED | 2-bit | 1-bit |
| SRAM | 8-bit SECDED | 2-bit | 1-bit |
| 寄存器 | 8-bit SECDED | 2-bit | 1-bit |

#### 3.2.3 看门狗配置

| 看门狗类型 | 超时时间 | 窗口模式 | ASIL 等级 |
|------------|----------|----------|-----------|
| 内部看门狗 | 1-100 ms | 支持 | ASIL-D |
| 外部看门狗 | 10-500 ms | 支持 | ASIL-D |
| 窗口看门狗 | 可配置 | 支持 | ASIL-D |

### 3.3 功耗预算

| 模块 | 功耗 (W) | 占比 |
|------|----------|------|
| 2x Cortex-R52 | 2.0 | 50% |
| L2 Cache + TCM | 1.0 | 25% |
| 安全逻辑 | 0.5 | 12.5% |
| 时钟复位 | 0.3 | 7.5% |
| 其他 | 0.2 | 5% |
| **总计** | **4.0** | **100%** |

---

## 4. 系统缓存架构 (L3 Cache)

### 4.1 L3 Cache 配置

| 参数 | 规格 |
|------|------|
| 大小 | 8 MB |
| 关联度 | 16 路组相联 |
| 块大小 | 64 Bytes |
| 替换策略 | Pseudo-LRU |
| 延迟 | 30-40 cycles |
| 带宽 | 256-bit/cycle |
| 频率 | 2.0 GHz |
| ECC | SECDED |
| 写策略 | 写回 + 写分配 |
| 包含性 | Non-inclusive |

### 4.2 一致性协议

| 协议 | ACE4 (CHI) |
|------|------------|
| 一致性域 | 全芯片 (CPU + GPU + NPU) |
| 协议类型 | MOESI 变体 |
| Snoop Filter | 2 MB, 全相联 |
| DVM 支持 | 是 |
| 序列化 | 支持 |

### 4.3 预取器配置

| 预取器类型 | 数量 | 策略 |
|------------|------|------|
| 顺序预取 | 2 | 线性地址序列 |
| 跨度预取 | 1 | 固定跨度模式 |
| 指令预取 | 1 | 分支目标预测 |

---

## 5. 接口规格

### 5.1 应用处理器集群接口

| 接口类型 | 协议 | 位宽 | 方向 | 带宽 |
|----------|------|------|------|------|
| ACE 主接口 | ACE4 | 512-bit | Out | 64 GB/s |
| ACE 从接口 | ACE4 | 512-bit | In | 64 GB/s |
| 中断接口 | GIC | 32 路 | In | - |
| 调试接口 | CoreSight | - | In/Out | - |
| 电源接口 | PSCI | - | In | - |

### 5.2 安全处理器集群接口

| 接口类型 | 协议 | 位宽 | 方向 | 带宽 |
|----------|------|------|------|------|
| AXI 主接口 | AXI4 | 256-bit | Out | 32 GB/s |
| AXI 从接口 | AXI4 | 256-bit | In | 32 GB/s |
| 中断接口 | GIC | 64 路 | In | - |
| 安全看门狗 | - | - | In/Out | - |
| 错误报告 | - | 32-bit | Out | - |

### 5.3 L3 Cache 接口

| 接口类型 | 协议 | 数量 | 峰值带宽 |
|----------|------|------|----------|
| ACE 从接口 | ACE4 | 4 | 256 GB/s |
| ACE 主接口 | ACE4 | 2 | 128 GB/s |
| SRAM 接口 | 自定义 | 16 banks | 64 GB/s |

---

## 6. 性能分析

### 6.1 性能指标

| 指标 | 目标值 | 模拟方法 |
|------|--------|----------|
| 单核 DMIPS | ≥ 12.5K | CoreMark |
| 单核 CoreMark/MHz | ≥ 4.0 | CoreMark |
| 整数 IPC | ≥ 2.0 | SPECint |
| 浮点 IPC | ≥ 2.0 | SPECfp |
| 内存带宽 | ≥ 100 GB/s | STREAM |
| 内存延迟 | ≤ 100 ns | 随机访问 |

### 6.2 瓶颈分析

| 瓶颈 | 影响 | 缓解措施 |
|------|------|----------|
| L1 Cache Miss | 10% 性能损失 | 优化预取 |
| L2 Cache Miss | 5% 性能损失 | 增加 L2 容量 |
| 内存带宽 | 3% 性能损失 | 增加 L3 带宽 |
| 分支预测错误 | 2% 性能损失 | 改进预测器 |

---

## 7. 功耗分析

### 7.1 功耗组成

| 模块 | 动态功耗 (W) | 静态功耗 (W) | 峰值功耗 (W) |
|------|--------------|--------------|--------------|
| 8x A78AE | 8.0 | 1.0 | 10.0 |
| 8x L2 Cache | 2.0 | 0.5 | 2.5 |
| 2x R52 + TCM | 2.0 | 0.5 | 2.5 |
| L3 Cache | 1.5 | 0.5 | 2.0 |
| SCU + 互连 | 0.8 | 0.2 | 1.0 |
| **总计** | **14.3** | **2.7** | **18.0** |

### 7.2 功耗优化技术

| 技术 | 应用 | 节省功耗 |
|------|------|----------|
| 时钟门控 | 所有模块 | 20-30% |
| 电源门控 | 未使用 Core | 40-60% |
| DVFS | 动态调整 | 10-20% |
| 电压缩放 | 降低电压 | 5-10% |
| SRAM 关闭 | 低功耗模式 | 30-50% |

---

## 8. 面积分析

### 8.1 面积预算

| 模块 | 面积 (mm²) | 占比 |
|------|------------|------|
| 8x Cortex-A78AE | 12.0 | 50% |
| 8x L2 Cache (4MB) | 4.0 | 17% |
| 2x Cortex-R52 | 2.5 | 10% |
| L2 Cache + TCM (R52) | 1.5 | 6% |
| L3 Cache (8MB) | 2.5 | 10% |
| SCU + 互连 | 1.0 | 4% |
| 其他 (时钟、复位、调试) | 0.5 | 2% |
| **总计** | **24.0** | **100%** |

### 8.2 面积优化

| 优化技术 | 目标节省 |
|----------|----------|
| 共享 L2 Cache | 10-15% |
| SRAM 面积优化 | 5-10% |
| 标准单元优化 | 5-8% |

---

## 9. 验证计划

### 9.1 验证目标

| 验证类型 | 覆盖率目标 | 工具 |
|----------|------------|------|
| 代码覆盖率 | ≥ 95% | VCS/Xcelium |
| 功能覆盖率 | 100% | UVM |
| 断言覆盖率 | ≥ 90% | SVA |
| 形式验证 | 关键模块 | JasperGold |

### 9.2 验证用例

| 用例类型 | 数量 | 说明 |
|----------|------|------|
| 功能测试 | 500+ | 正常操作测试 |
| 异常测试 | 200+ | 边界条件测试 |
| 性能测试 | 50+ | 性能基准测试 |
| 安全测试 | 100+ | 安全机制测试 |
| 一致性测试 | 100+ | ACE/AXI 协议测试 |

---

## 10. 交付物和时间表

| 交付物 | 截止日期 | 状态 |
|--------|----------|------|
| CPU 微架构规格 | 2026-02-28 | 未开始 |
| 接口规格 | 2026-03-15 | 未开始 |
| RTL 代码冻结 | 2026-06-30 | 未开始 |
| DV 验证通过 | 2026-09-30 | 未开始 |

---

## 11. 审批

| 角色 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| CPU 架构师 | [待确认] | - | - |
| 首席架构师 | [待确认] | - | - |
| 项目经理 | [待确认] | - | - |

---

**文档版本**: V1.0  
**最后更新**: 2026-01-19  
**状态**: 草稿  
**下一步**: 开始 RTL 代码开发

---
*本规格书作为 CPU 子系统详细设计的指导文件。*