# YaoGuang SoC 后端设计流程

| 文档版本 | V1.0 |
|---------|------|
| 创建日期 | 2026-01-18 |
| 状态 | 初稿 |
| 负责人 | 后端工程师 |

## 1. 流程总览

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              YaoGuang SoC 后端设计流程                               │
└─────────────────────────────────────────────────────────────────────────────────────┘

  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
  │  RTL    │───▶│ 综合    │───▶│ DFT     │───▶│ Floor   │───▶│ 布局    │
  │  代码   │    │ Synthesis│    │ 插入    │    │ plan    │    │ Placement│
  └─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘
       │              │              │              │              │
       ▼              ▼              ▼              ▼              ▼
  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
  │ 设计    │    │ 门级    │    │ 测试    │    │ 布局    │    │ 标准    │
  │ 验证    │    │ 网表    │    │ 结构    │    │ 规划    │    │ 单元    │
  │ 完成    │    │ 生成    │    │ 插入    │    │ 完成    │    │ 放置    │
  └─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘
                                                                    │
  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐         │
  │ 时序    │◀───│ 寄生    │◀───│ 布线    │◀───│ CTS     │◀────────┘
  │ 收敛    │    │ 提取    │    │ 布线    │    │ 时钟树  │
  └─────────┘    └─────────┘    └─────────┘    └─────────┘
       │
       ▼
  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
  │ 物理    │◀───│ ECO     │◀───│ 时序    │◀───│ 详细    │
  │ 验证    │    │ 修复    │    │ 分析    │    │ 布线    │
  └─────────┘    └─────────┘    └─────────┘    └─────────┘
       │
       ▼
  ┌─────────┐
  │ GDSII   │
  │ 流片    │
  └─────────┘
```

## 2. 详细阶段流程

### 2.1 逻辑综合阶段

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              逻辑综合流程                                         │
└─────────────────────────────────────────────────────────────────────────────────┘

  ┌───────────────┐
  │ 1. 准备输入   │
  │   - RTL代码   │
  │   - 标准单元库│
  │   - SDC约束   │
  └───────┬───────┘
          │
          ▼
  ┌───────────────┐
  │ 2. 载入库文件 │
  │   - link_library│
  │   - target_library│
  │   - symbol_library│
  └───────┬───────┘
          │
          ▼
  ┌───────────────┐
  │ 3. 读入RTL    │
  │   - analyze   │
  │   - elaborate │
  └───────┬───────┘
          │
          ▼
  ┌───────────────┐
  │ 4. 设置约束   │
  │   - 时钟定义  │
  │   - IO约束    │
  │   - 多周期    │
  └───────┬───────┘
          │
          ▼
  ┌───────────────┐
  │ 5. 综合优化   │
  │   - 编译策略  │
  │   - 面积优化  │
  │   - 功耗优化  │
  └───────┬───────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 6. 评估报告   │────▶│ 7. 迭代优化   │
  │   - 时序报告  │     │   - 约束调整  │
  │   - 面积报告  │     │   - 策略调整  │
  │   - 功耗报告  │     │   - 重新综合  │
  └───────┬───────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐
  │ 8. 输出网表   │
  │   - Verilog   │
  │   - SDC       │
  │   - 报告      │
  └───────────────┘
```

### 2.2 DFT插入阶段

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              DFT插入流程                                         │
└─────────────────────────────────────────────────────────────────────────────────┘

  ┌───────────────┐
  │ 1. DFT规划   │
  │   - 扫描策略  │
  │   - 压缩方案  │
  │   - MBIST范围 │
  └───────┬───────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 2. 扫描链插入 │────▶│ 3. 扫描链平衡 │
  │   - DFT Compiler│    │   - 链长度均衡│
  │   - 替换DFF   │     │   - 连接检查  │
  └───────┬───────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 4. MBIST插入  │────▶│ 5. JTAG集成   │
  │   - 存储器映射│     │   - BSDL定义  │
  │   - BIST控制器│     │   - TAP控制器│
  └───────┬───────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 6. ATPG生成   │────▶│ 7. 向量验证   │
  │   - 故障定义  │     │   - 仿真验证  │
  │   - 向量生成  │     │   - 覆盖率统计│
  └───────┬───────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐
  │ 8. 输出DFT网表│
  │   - 带扫描网表│
  │   - STIL向量  │
  │   - DFT报告   │
  └───────────────┘
```

### 2.3 Floorplan阶段

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              Floorplan流程                                       │
└─────────────────────────────────────────────────────────────────────────────────┘

  ┌───────────────┐
  │ 1. 分析设计   │
  │   - 网表分析  │
  │   - 宏单元识别│
  │   - 层次结构  │
  └───────┬───────┘
          │
          ▼
  ┌───────────────┐
  │ 2. 制定策略   │
  │   - 芯片利用率│
  │   - 区域划分  │
  │   - 通道设计  │
  └───────┬───────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 3. 宏单元放置 │────▶│ 4. 宏单元优化 │
  │   - 核心模块  │     │   - 位置调整  │
  │   - IP硬核    │     │   - 间距检查  │
  │   - 存储器    │     │   - 电源连接  │
  └───────┬───────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 5. 电源规划   │────▶│ 6. IO规划     │
  │   - PG Mesh   │     │   - IO单元放置│
  │   - 电源条    │     │   - 电源引脚  │
  │   -  strap    │     │   - 高速接口  │
  └───────┬───────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 7. 布局验证   │────▶│ 8. 迭代优化   │
  │   - 拥塞分析  │     │   - 调整放置  │
  │   - 时序预估  │     │   - 重新规划  │
  │   - 电源分析  │     │   - 验证通过  │
  └───────────────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐
  │ 9. 输出DEF    │
  │   - Floorplan │
  │   - 布局DEF   │
  └───────────────┘
```

### 2.4 布局布线阶段

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              P&R流程                                             │
└─────────────────────────────────────────────────────────────────────────────────┘

  ┌───────────────┐
  │ 1. 全局布局   │
  │   - 近似布局  │
  │   - 线长优化  │
  │   - 时序驱动  │
  └───────┬───────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 2. 详细布局   │────▶│ 3. 放置优化   │
  │   - 精确位置  │     │   - 间距修复  │
  │   - 站点对齐  │     │   - 密度均衡  │
  │   - 设计规则  │     │   - 靠近驱动  │
  └───────┬───────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 4. 时钟树综合 │────▶│ 5. CTS优化    │
  │   - H-tree    │     │   - Skew平衡  │
  │   - 平衡树    │     │   - 延迟优化  │
  │   - 栅格树    │     │   - 转换优化  │
  └───────┬───────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 6. 全局布线   │────▶│ 7. 详细布线   │
  │   - 资源分配  │     │   - 精确走线  │
  │   - 初步连接  │     │   - 规则检查  │
  │   - 拥塞分析  │     │   - 短路修复  │
  └───────┬───────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 8. 布线优化   │────▶│ 9. SI修复     │
  │   - 串扰消除  │     │   - 屏蔽添加  │
  │   - 时序修复  │     │   - 间距调整  │
  │   - 冗余填充  │     │   - 线宽调整  │
  └───────┬───────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐
  │ 10. 输出结果  │
  │    - 布线网表 │
  │    - 布线DEF  │
  │    - 报告     │
  └───────────────┘
```

### 2.5 时序收敛阶段

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              时序收敛流程                                        │
└─────────────────────────────────────────────────────────────────────────────────┘

  ┌───────────────┐
  │ 1. 寄生提取   │
  │   - RC提取    │
  │   - 3D模型    │
  │   - 多corner  │
  └───────┬───────┘
          │
          ▼
  ┌───────────────┐
  │ 2. STA分析    │
  │   - Setup检查 │
  │   - Hold检查  │
  │   - 多模式    │
  └───────┬───────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 3. 违例识别   │────▶│ 4. 违例分类   │
  │   - WNS/TNS   │     │   - 关键路径  │
  │   - 路径报告  │     │   - 违例类型  │
  └───────┬───────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐     ┌───────────────┐
  │ 5. ECO修复    │────▶│ 6. 重新提取   │────▶│ 7. 重新分析   │
  │   - 缓冲器插入│     │   - 更新RC    │     │   - 验证修复  │
  │   - 尺寸调整  │     │   │             │     │   │           │
  │   - 门替换    │     │   └────────────┘     │   └────────────┘
  └───────┬───────┘                          │
          │                                   │
          ▼                                   │
  ┌───────────────┐◀──────────────────────────┘
  │ 8. 时序收敛   │
  │   - 全corner  │
  │   - 全mode    │
  │   - 签核标准  │
  └───────────────┘
```

### 2.6 物理验证阶段

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              物理验证流程                                        │
└─────────────────────────────────────────────────────────────────────────────────┘

  ┌───────────────┐
  │ 1. DRC检查    │
  │   - 设计规则  │
  │   - 最小间距  │
  │   - 最小宽度  │
  │   - 天线比    │
  └───────┬───────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 2. DRC修复    │────▶│ 3. DRC复查    │
  │   - 违例定位  │     │   - 全部通过  │
  │   - 修复策略  │     │   │           │
  │   - 版图修改  │     │   └────────────┘
  └───────┬───────┘          │
          │                   │
          ▼                   │
  ┌───────────────┐          │
  │ 4. LVS检查    │──────────┘
  │   - 器件匹配  │
  │   - 连接匹配  │
  │   - 属性匹配  │
  └───────┬───────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 5. LVS修复    │────▶│ 6. LVS复查    │
  │   - 不匹配定位│     │   - 完全匹配  │
  │   - 版图修改  │     │   │           │
  └───────┬───────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐     ┌───────────────┐
  │ 7. EM/IR分析  │────▶│ 8. 功耗分析   │
  │   - 电流密度  │     │   - 动态功耗  │
  │   - 压降分析  │     │   - 静态功耗  │
  │   - 电迁移    │     │   - 热分析    │
  └───────┬───────┘     └───────────────┘
          │
          ▼
  ┌───────────────┐
  │ 9. 最终验证   │
  │   - 全项通过  │
  │   - 准备签核  │
  └───────────────┘
```

## 3. 迭代与反馈流程

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              迭代优化流程                                        │
└─────────────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────────┐
  │                              正常流程                                        │
  └─────────────────────────────────────────────────────────────────────────────┘
  
  开始 ──▶ 阶段完成 ──▶ 验证通过 ──▶ 进入下一阶段 ──▶ 结束

  ┌─────────────────────────────────────────────────────────────────────────────┐
  │                              异常流程                                        │
  └─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
  │ 阶段    │────▶│ 验证    │───▶│ 违例    │───▶│ 返回    │
  │ 执行    │     │ 检查    │     │ 发现    │     │ 优化    │
  └─────────┘     └─────────┘     └─────────┘     └─────────┘
                        │                │               │
                        │                ▼               │
                        │          ┌─────────┐          │
                        │          │ 问题    │──────────┘
                        │          │ 升级    │
                        │          └─────────┘
                        │
                        ▼
                  ┌─────────┐
                  │ 记录    │
                  │ 问题单  │
                  └─────────┘

  ┌─────────────────────────────────────────────────────────────────────────────┐
  │                              跨阶段反馈                                      │
  └─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
  │ 综合    │────▶│ DFT     │────▶│ Floor   │────▶│ P&R     │
  │ 阶段    │     │ 阶段    │     │ plan    │     │ 阶段    │
  └─────────┘     └─────────┘     └─────────┘     └─────────┘
      │               │               │               │
      │               │               │               │
      ▼               ▼               ▼               ▼
  ┌─────────────────────────────────────────────────────────────────────────────┐
  │                              问题反馈链路                                    │
  │   上游阶段发现的问题 ──▶ 相关团队 ──▶ 上游阶段修复 ──▶ 重新验证             │
  └─────────────────────────────────────────────────────────────────────────────┘
```

## 4. 关键检查点流程

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              质量门控流程                                        │
└─────────────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────────┐
  │  综合评审点 (Gate 1)                                                        │
  ├─────────────────────────────────────────────────────────────────────────────┤
  │  检查项: 时序收敛率>90%, 面积<60%, 功耗达标                                 │
  │  输入: 综合报告, 网表, SDC                                                  │
  │  输出: 综合评审通过/不通过                                                  │
  │  决策者: 后端工程师, 架构师                                                 │
  └─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
  ┌─────────────────────────────────────────────────────────────────────────────┐
  │  DFT评审点 (Gate 2)                                                         │
  ├─────────────────────────────────────────────────────────────────────────────┤
  │  检查项: 覆盖率>95%, 压缩率>50:1, 无测试冲突                                │
  │  输入: DFT报告, ATPG向量                                                    │
  │  输出: DFT评审通过/不通过                                                   │
  │  决策者: DFT工程师, 测试工程师                                              │
  └─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
  ┌─────────────────────────────────────────────────────────────────────────────┐
  │  Floorplan评审点 (Gate 3)                                                   │
  ├─────────────────────────────────────────────────────────────────────────────┤
  │  检查项: 宏单元放置合理, 电源网络完整, 拥塞可控                             │
  │  输入: Floorplan DEF, 布局报告                                              │
  │  输出: Floorplan评审通过/不通过                                             │
  │  决策者: 后端工程师, 架构师                                                 │
  └─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
  ┌─────────────────────────────────────────────────────────────────────────────┐
  │  P&R评审点 (Gate 4)                                                         │
  ├─────────────────────────────────────────────────────────────────────────────┤
  │  检查项: 布线完成率100%, 无开路/短路, SI满足                                │
  │  输入: 布线后网表, 布线DEF, 报告                                            │
  │  输出: P&R评审通过/不通过                                                   │
  │  决策者: 后端工程师                                                         │
  └─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
  ┌─────────────────────────────────────────────────────────────────────────────┐
  │  时序评审点 (Gate 5)                                                        │
  ├─────────────────────────────────────────────────────────────────────────────┤
  │  检查项: Setup/Hold全corner收敛, 无时序违例                                 │
  │  输入: 签核网表, 时序报告                                                   │
  │  输出: 时序评审通过/不通过                                                  │
  │  决策者: 时序工程师, 后端工程师                                             │
  └─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
  ┌─────────────────────────────────────────────────────────────────────────────┐
  │  物理验证评审点 (Gate 6)                                                    │
  ├─────────────────────────────────────────────────────────────────────────────┤
  │  检查项: DRC清洁, LVS清洁, 天线通过                                         │
  │  输入: GDSII, 验证报告                                                      │
  │  输出: 物理验证评审通过/不通过                                              │
  │  决策者: 物理验证工程师                                                     │
  └─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
  ┌─────────────────────────────────────────────────────────────────────────────┐
  │  最终签核评审点 (Gate 7)                                                    │
  ├─────────────────────────────────────────────────────────────────────────────┤
  │  检查项: 所有签核项通过, 数据包完整                                         │
  │  输入: 全套签核数据                                                         │
  │  输出: 流片批准/不批准                                                      │
  │  决策者: 项目经理, 技术负责人                                               │
  └─────────────────────────────────────────────────────────────────────────────┘
```

## 5. 工具与数据流

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              工具与数据流                                        │
└─────────────────────────────────────────────────────────────────────────────────┘

  ┌────────────┐      ┌────────────┐      ┌────────────┐
  │ Design     │      │ DFT        │      │ IC Compiler│
  │ Compiler   │────▶│ Compiler   │────▶│ II         │
  │ (综合)     │      │ (DFT)      │      │ (P&R)      │
  └────────────┘      └────────────┘      └────────────┘
       │                    │                    │
       ▼                    ▼                    ▼
  ┌────────────┐      ┌────────────┐      ┌────────────┐
  │ .db/.lib   │      │ .def       │      │ PrimeTime  │
  │ 网表       │      │ 网表       │────▶│ (STA)      │
  │ SDC        │      │ Scan定义   │      │            │
  └────────────┘      └────────────┘      └────────────┘
                                               │
                                               ▼
  ┌────────────┐      ┌────────────┐      ┌────────────┐
  │ StarRC     │◀─────│ Calibre    │◀─────│ PrimeTime  │
  │ (RC提取)   │      │ (DRC/LVS)  │      │ (ECO)      │
  └────────────┘      └────────────┘      └────────────┘
       │                    │                    │
       ▼                    ▼                    ▼
  ┌─────────────────────────────────────────────────────────────┐
  │                        输出文件                             │
  │  - GDSII版图    - 网表文件    - 时序库                      │
  │  - SDC约束      - 测试向量    - 报告文档                    │
  └─────────────────────────────────────────────────────────────┘
```
