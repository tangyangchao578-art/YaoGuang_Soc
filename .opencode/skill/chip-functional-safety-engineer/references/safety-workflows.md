# 功能安全分析工作流程

## FMEA工作流程

### 1. 准备阶段

**团队组建：**
- 功能安全工程师（牵头）
- 系统工程师
- 硬件工程师
- 软件工程师
- 可靠性工程师

**资料收集：**
- 系统需求规范
- 硬件设计规范
- 软件设计规范
- 接口规范
- 测试规范

**工具准备：**
- FMEA工具（APIS IQ-RM、Reliasoft等）
- Excel模板
- 数据库

### 2. 功能识别

**步骤：**
1. 列出所有系统功能
2. 定义每个功能的输入
3. 定义每个功能的输出
4. 定义每个功能的时序

**功能示例：**
```
功能ID: F-001
功能名称: ECU看门狗监控
功能描述: 监控ECU运行状态，检测故障并复位
输入: 心跳信号、状态寄存器
输出: 复位信号、故障标志
时序: 每个时钟周期监控，FTTI=10ms
```

### 3. 失效模式识别

**失效模式分类：**

**硬件失效模式：**
- 固定故障（stuck-at-0, stuck-at-1）
- 桥接故障
- 开路故障
- 参数故障（电压、电流、温度）

**软件失效模式：**
- 逻辑错误
- 死锁
- 数据损坏
- 时序错误

**系统失效模式：**
- 通信错误
- 时序错误
- 协议错误

**失效模式识别方法：**
- 头脑风暴
- 检查表
- 经验数据
- 故障树分析

### 4. 失效影响分析

**影响等级：**
- **严重度（S）**: 1-10
  - 1: 无影响
  - 2-3: 轻微影响
  - 4-6: 中等影响
  - 7-8: 严重影响
  - 9-10: 灾难性影响

**影响分析步骤：**
1. 分析对系统的直接影
2. 分析对系统功能的影响
3. 分析对车辆/用户的影响
4. 分析对环境的影响

**影响示例：**
```
失效模式: CPU锁步不匹配
严重度: 9 (可能导致车辆失控)
影响: ECU计算错误 → 车辆控制失效 → 可能导致事故
```

### 5. 失效原因分析

**原因分类：**
- **设计缺陷**: 设计不合理
- **制造缺陷**: 制造工艺问题
- **老化失效**: 长期使用导致的失效
- **环境因素**: 温度、湿度、振动等
- **软件缺陷**: 代码错误

**发生频率（O）:**
- 1: 极不可能
- 2-3: 低
- 4-6: 中等
- 7-8: 高
- 9-10: 极高

### 6. 可检测性分析

**检测方法：**
- **在线检测**: 运行时检测
- **离线检测**: 测试时检测
- **自诊断**: 芯片自诊断
- **外部监控**: 外部监控

**可检测度（D）:**
- 1-2: 容易检测
- 3-4: 中等可检测
- 5-6: 难以检测
- 7-8: 很难检测
- 9-10: 几乎不可能检测

### 7. RPN计算和优先级排序

**RPN计算：**
```
RPN = 严重度(S) × 发生频率(O) × 可检测度(D)
```

**优先级排序：**
- 高优先级: RPN > 200
- 中优先级: 100 < RPN ≤ 200
- 低优先级: RPN ≤ 100

### 8. 改进措施制定

**措施类型：**
- **设计改进**: 改进设计
- **增加检测**: 增加故障检测
- **降低频率**: 降低失效频率
- **提高可靠性**: 提高系统可靠性

**措施验证：**
- 重新计算RPN
- 验证措施有效性
- 更新FMEA文档

## FTA工作流程

### 1. 顶事件定义

**顶事件选择：**
- 系统级失效
- 安全关键失效
- 用户报告的失效

**顶事件示例：**
```
顶事件: 车辆失控
ASIL: ASIL D
FTTI: 10ms
```

### 2. 故障树构建

**构建规则：**
- 从顶事件开始，逐层分解
- 每一层用逻辑门连接
- 基本事件到达组件级

**常用逻辑门：**
- **与门（AND）**: 所有输入发生，输出才发生
- **或门（OR）**: 任一输入发生，输出就发生
- **禁止门（INHIBIT）**: 条件发生时，禁止事件
- **优先与门（PAND）**: 按特定顺序发生

### 3. 最小割集识别

**最小割集：**
- 最小的基本事件组合
- 这些事件发生会导致顶事件发生

**识别方法：**
- **MOCUS**: Method of Obtaining Cut Sets
- **ZBDD**: Zero-Suppressed Binary Decision Diagram
- **计算机辅助分析**

**最小割集示例：**
```
顶事件: 车辆失控

最小割集1: {CPU故障, 看门狗失效}
最小割集2: {传感器故障, 诊断失效}
最小割集3: {电源故障}
```

### 4. 定性分析

**分析内容：**
- 识别关键失效路径
- 识别共因失效
- 识别设计弱点
- 评估系统健壮性

**分析指标：**
- **最小割集数量**: 越少越健壮
- **割集阶数**: 阶数越高越健壮
- **共因失效**: 识别共因失效

### 5. 定量分析

**计算内容：**
- 顶事件发生概率
- 基本事件重要度
- 系统可靠度

**重要度指标：**
- **结构重要度**: 基于结构
- **概率重要度**: 基于概率
- **关键重要度**: 概率和敏感度

## FMEDA工作流程

### 1. 组件识别

**组件清单：**
- 列出所有硬件组件
- 列出所有软件模块
- 列出所有接口

**组件信息：**
- 组件类型
- 组件功能
- 组件数量
- 失效率

### 2. 失效模式分析

**失效模式识别：**
- 参考标准（如MIL-HDBK-217）
- 参考历史数据
- 专家判断

**失效模式分类：**
- **安全相关失效**: 影响安全
- **非安全相关失效**: 不影响安全

### 3. 失效率数据收集

**数据来源：**
- **IEC TR 62380**: 失效率数据
- **MIL-HDBK-217**: 军用可靠性数据
- **FIDES**: 电子器件失效率
- **SN 29500**: 西门子标准

**失效率计算：**
```
FIT = 失效率 × 10⁹
```

### 4. 诊断机制分析

**诊断类型：**
- **在线诊断**: 运行时诊断
- **离线诊断**: 测试时诊断
- **周期诊断**: 周期性诊断

**诊断覆盖率计算：**
```
DC = (Σ(λ_safe_detected) / Σλ_safe) × 100%
```

### 5. 安全指标计算

**计算指标：**

**SPFM（单点故障度量）：**
```
SPFM = 1 - (Σλ_SPF / Σλ)
```

**LFM（潜伏故障度量）：**
```
LFM = 1 - (Σλ_LF / Σλ)
```

**PMHF（随机硬件失效概率）：**
```
PMHF = Σλ × (1 - DC)
```

**目标值：**
| ASIL | SPFM | LFM | PMHF |
|------|------|-----|------|
| A | > 90% | > 60% | < 100 FIT |
| B | > 90% | > 60% | < 10 FIT |
| C | > 97% | > 80% | < 1 FIT |
| D | > 99% | > 90% | < 0.1 FIT |

### 6. 安全机制验证

**验证方法：**
- 故障注入
- 仿真验证
- 理论计算
- 实际测试

**验证标准：**
- 诊断覆盖率达标
- 故障检测时间 < FTTI
- 安全机制独立
- 安全机制可靠

## 故障注入工作流程

### 1. 故障场景定义

**故障类型：**
- **永久故障**: 固定故障、桥接故障
- **瞬态故障**: 单粒子翻转、电磁干扰
- **间歇故障**: 参数漂移、老化

**故障位置：**
- 寄存器
- 存储器
- 组合逻辑
- 时序逻辑
- 接口

**故障时间：**
- 启动阶段
- 运行阶段
- 关闭阶段
- 随机时间

### 2. 故障注入工具配置

**工具选择：**
- **软件注入**: Xception, FiTH
- **硬件注入**: FITS, 激光注入
- **仿真注入**: 仿真工具

**配置参数：**
- 故障类型
- 故障位置
- 故障持续时间
- 故障注入频率

### 3. 故障注入执行

**执行步骤：**
1. 初始化系统
2. 执行正常操作
3. 注入故障
4. 监控系统响应
5. 记录结果
6. 清除故障
7. 重复测试

### 4. 结果分析

**分析内容：**
- 故障是否被检测到
- 故障检测时间
- 系统是否进入安全状态
- 安全机制是否正确响应

**统计指标：**
- 检测到的故障数
- 未检测到的故障数
- 诊断覆盖率
- 故障检测时间分布

### 5. 诊断覆盖率计算

**覆盖率计算：**
```
DC = (检测到的故障数 / 注入的故障数) × 100%
```

**目标覆盖率：**
- ASIL A: ≥ 60%
- ASIL B: ≥ 90%
- ASIL C: ≥ 97%
- ASIL D: ≥ 99%

## 安全案例开发工作流程

### 1. 案例结构设计

**基本结构：**
- 引言
- 安全目标
- 系统描述
- 安全分析
- 安全机制
- 验证和确认
- 证据

### 2. 证据收集

**证据类型：**
- 文档证据
- 设计数据
- 测试结果
- 分析报告
- 审核记录

### 3. 案例编写

**编写原则：**
- 清晰明确
- 逻辑连贯
- 证据充分
- 可追溯

### 4. 案例评审

**评审内容：**
- 结构完整性
- 证据充分性
- 逻辑一致性
- 符合标准

### 5. 案例维护

**维护活动：**
- 更新证据
- 跟踪变更
- 定期评审
- 持续改进
