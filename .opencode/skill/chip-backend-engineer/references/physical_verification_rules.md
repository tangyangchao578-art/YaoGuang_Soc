# 物理验证规则详解

## 概述

本文档详细解释Calibre DRC/LVS物理验证的规则、检查方法和常见违例修复策略。

## 1. DRC规则分类

### 1.1 基本几何规则

**最小宽度：**
- 规则目的：确保金属线宽度大于工艺最小宽度
- 常见违例：细金属线、金属线变窄
- 修复方法：增加金属线宽度

**最小间距：**
- 规则目的：确保相邻金属线间距满足工艺要求
- 常见违例：金属线靠得太近
- 修复方法：增加金属线间距或移动金属线

**最小面积：**
- 规则目的：确保金属图形面积大于工艺最小面积
- 常见违例：小金属块、小金属接触
- 修复方法：增大金属图形面积

### 1.2 通孔规则

**通孔最小宽度：**
- 规则目的：确保通孔尺寸满足工艺要求
- 常见违例：通孔尺寸过小
- 修复方法：增大通孔尺寸

**通孔最小间距：**
- 规则目的：确保相邻通孔间距满足工艺要求
- 常见违例：通孔靠得太近
- 修复方法：增加通孔间距

**通孔包围：**
- 规则目的：确保通孔被金属层充分包围
- 常见违例：通孔超出金属边界
- 修复方法：调整通孔位置或增大金属

### 1.3 天线效应规则

**天线比率：**
- 规则目的：防止金属线累积电荷导致栅氧击穿
- 常见违例：长金属线、大面积金属
- 修复方法：插入跳线、增加天线二极管

**天线门比率：**
- 规则目的：防止栅极累积过多电荷
- 常见违例：栅极连接大金属线
- 修复方法：插入跳线、插入天线二极管

**差分天线：**
- 规则目的：防止差分对天线效应
- 常见违例：差分对金属线长度不匹配
- 修复方法：平衡差分对金属线长度

### 1.4 电源网络规则

**电源连接：**
- 规则目的：确保所有单元正确连接到电源
- 常见违例：单元未连接VDD/VSS
- 修复方法：检查并修复电源连接

**最小电源宽度：**
- 规则目的：确保电源线宽度足够承载电流
- 常见违例：电源线太细
- 修复方法：增加电源线宽度

**电源密度：**
- 规则目的：确保电源线分布均匀
- 常见违例：电源线密度不均
- 修复方法：调整电源线分布

### 1.5 多边形规则

**非正交角度：**
- 规则目的：限制多边形角度偏差
- 常见违例：非直角多边形
- 修复方法：使用正交多边形

**最小边数：**
- 规则目的：限制多边形边数
- 常见违例：复杂多边形
- 修复方法：简化多边形

**最小内角：**
- 规则目的：防止尖角
- 常见违例：锐角多边形
- 修复方法：消除锐角

## 2. LVS规则分类

### 2.1 器件识别

**MOSFET识别：**
- 规则目的：正确识别NMOS和PMOS器件
- 常见违例：器件类型不匹配
- 修复方法：检查器件连接和类型

**电阻识别：**
- 规则目的：正确识别电阻器件
- 常见违例：电阻值不匹配
- 修复方法：调整电阻尺寸

**电容识别：**
- 规则目的：正确识别电容器件
- 常见违例：电容值不匹配
- 修复方法：调整电容尺寸

### 2.2 连接匹配

**网络匹配：**
- 规则目的：确保版图和网表的网络一致
- 常见违例：网络连接不匹配
- 修复方法：检查并修复网络连接

**端点匹配：**
- 规则目的：确保端点连接正确
- 常见违例：端点连接错误
- 修复方法：检查端点连接

**电源连接：**
- 规则目的：确保电源网络正确连接
- 常见违例：电源连接错误
- 修复方法：修复电源连接

### 2.3 参数匹配

**尺寸参数：**
- 规则目的：确保器件尺寸参数匹配
- 常见违例：W/L参数不匹配
- 修复方法：调整器件尺寸

**电气参数：**
- 规则目的：确保电气参数在容差范围内
- 常见违例：参数超出容差
- 修复方法：调整参数值

## 3. DRC修复策略

### 3.1 分析DRC报告

```bash
# 运行DRC
calibre -drc -hier -turbo -64 design.drc

# 查看DRC报告
cat your_design.drc.rpt

# 使用图形界面查看
calibredrv your_design.gds
```

### 3.2 修复优先级

**优先级1：致命违例（必须修复）**
- 电源/地短路
- 关键信号短路
- 器件缺失

**优先级2：严重违例（建议修复）**
- 最小宽度/间距
- 天线效应
- 通孔问题

**优先级3：一般违例（可选修复）**
- 填充密度
- 非关键信号短路
- 装饰性图形

### 3.3 自动修复

```tcl
# ICC2自动修复DRC
verify_drc -limit 1000
fix_drc -type all

# 或分步修复
fix_drc -type minimum_spacing
fix_drc -type minimum_width
fix_drc -type antenna
```

### 3.4 手动修复

**最小间距修复：**
1. 选择违例金属线
2. 向旁边移动
3. 检查是否影响其他规则

**最小宽度修复：**
1. 选择违例金属线
2. 增加宽度
3. 检查是否影响其他规则

**天线效应修复：**
1. 选择违例金属线
2. 插入跳线到不同层
3. 或插入天线二极管

## 4. LVS修复策略

### 4.1 分析LVS报告

```bash
# 运行LVS
calibre -lvs design.lvs

# 查看LVS报告
cat your_design.lvs.report

# 分析不匹配
# 查看DEVICE MISMATCH部分
# 查看NET MISMATCH部分
```

### 4.2 器件不匹配修复

**器件缺失：**
1. 检查网表是否包含该器件
2. 检查版图是否正确绘制
3. 修复版图或网表

**器件类型错误：**
1. 检查器件连接
2. 验证器件类型
3. 修复器件类型

**器件参数不匹配：**
1. 检查器件尺寸
2. 调整版图或网表参数
3. 确保在容差范围内

### 4.3 网络不匹配修复

**网络缺失：**
1. 检查网表连接
2. 检查版图连接
3. 修复缺失的连接

**网络短路：**
1. 定位短路位置
2. 断开短路
3. 验证修复

**网络开路：**
1. 定位开路位置
2. 连接开路网络
3. 验证修复

## 5. 物理验证检查清单

### 5.1 DRC检查前
- [ ] 版图GDS文件正确
- [ ] 工艺文件正确
- [ ] 规则文件完整
- [ ] 映射文件正确

### 5.2 DRC检查后
- [ ] 无DRC违例
- [ ] 所有修复验证通过
- [ ] 报告完整
- [ ] 版图一致性验证

### 5.3 LVS检查前
- [ ] 版图GDS文件正确
- [ ] 网表文件正确
- [ ] 器件规则正确
- [ ] 连接规则正确

### 5.4 LVS检查后
- [ ] LVS通过
- [ ] 无器件不匹配
- [ ] 无网络不匹配
- [ ] 参数在容差内

## 6. 常见问题和解决方案

### 6.1 DRC常见问题

**问题：** DRC违例过多
- 检查规则文件是否正确
- 检查版图是否正确
- 考虑使用分层修复

**问题：** 修复后产生新违例
- 检查修复方法
- 使用迭代修复
- 验证修复影响

**问题：** 无法修复某些违例
- 检查是否为设计限制
- 考虑调整设计
- 与工艺工程师沟通

### 6.2 LVS常见问题

**问题：** LVS不通过
- 检查网表和版图一致性
- 检查器件识别规则
- 检查连接规则

**问题：** 器件不匹配
- 检查器件类型
- 检查器件连接
- 检查器件参数

**问题：** 网络不匹配
- 检查网络名称
- 检查网络连接
- 检查电源连接

## 7. 最佳实践

1. **分层验证**：先验证单元，再验证模块，最后验证顶层
2. **定期验证**：在布局、布线各阶段都进行验证
3. **自动修复优先**：使用工具自动修复，提高效率
4. **手动修复精细**：对复杂违例使用手动修复
5. **版本管理**：保存每次修复的版本
6. **文档记录**：记录修复方法和经验

## 8. 参考文档

- Calibre DRC User Guide
- Calibre LVS User Guide
- 工艺DRC/LVS规则文档
- 项目物理验证流程
