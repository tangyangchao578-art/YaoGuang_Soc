# I2C/SPI/GPIO 复合模块特性列表

## 文档信息

| 项目 | 内容 |
|------|------|
| 模块名称 | I2C/SPI/GPIO Composite Controller |
| 版本 | V1.0 |
| 创建日期 | 2026-01-19 |
| 目标 ASIL | QM |

---

## 1. 总体特性

### 1.1 集成配置

| 子模块 | 数量 | 独立时钟域 | 优先级 |
|--------|------|------------|--------|
| I2C 控制器 | 4 通道 | 是 | 必须 |
| SPI 控制器 | 4 通道 | 是 | 必须 |
| GPIO | 128 位 | 是 | 必须 |
| 中断聚合器 | 1 个 | 是 | 必须 |

### 1.2 接口配置

| 接口类型 | 位宽 | 协议 | 桥接方式 |
|----------|------|------|----------|
| APB4 | 32-bit | APB4 | 从设备 |
| 中断 | 32-bit | 电平/脉冲 | 汇总输出 |
| 复位 | 异步复位 | 低有效 | 独立复位 |

---

## 2. I2C 控制器特性 (4 通道)

### 2.1 协议支持

| 特性 | 描述 | 优先级 |
|------|------|--------|
| I2C Standard | 100 kHz 模式 | 必须 |
| I2C Fast | 400 kHz 模式 | 必须 |
| I2C Fast-mode Plus | 1 MHz 模式 | 必须 |
| I2C SMBus | SMBus 协议支持 | 必须 |
| 7-bit 地址 | 7-bit 从地址 | 必须 |
| 10-bit 地址 | 10-bit 从地址 | 必须 |
| 广播地址 | 广播呼叫支持 | 必须 |
| 时钟拉伸 | 时钟同步/拉伸 | 必须 |

### 2.2 功能特性

| 特性 | 描述 | 取值 |
|------|------|------|
| 发送 FIFO | TX 深度 | 32 |
| 接收 FIFO | RX 深度 | 32 |
| 滤波器 | Glitch 滤波器 | 2-4 Tclk |
| 速度配置 | 每通道独立速度 | 100K/400K/1M |
| 主机/从机 | 模式配置 | 可配置 |
| 地址检测 | 双地址检测 | 可选 |

### 2.3 传输模式

| 特性 | 描述 | 优先级 |
|------|------|--------|
| 主发送 | 主机模式发送 | 必须 |
| 主接收 | 主机模式接收 | 必须 |
| 从发送 | 从机模式发送 | 必须 |
| 从接收 | 从机模式接收 | 必须 |
| 重复 START | 重复起始条件 | 必须 |
| 字节传输 | 字节传输模式 | 必须 |

### 2.4 错误检测

| 特性 | 描述 | 优先级 |
|------|------|--------|
| ACK 错误 | ACK 缺失检测 | 必须 |
| 仲裁丢失 | 多主机仲裁 | 必须 |
| 从机地址匹配 | 地址匹配检测 | 必须 |
| 停止位检测 | STOP 条件检测 | 必须 |
| 超长检测 | 传输超时 | 可选 |
| 溢出检测 | RX FIFO 溢出 | 必须 |

---

## 3. SPI 控制器特性 (4 通道)

### 3.1 协议支持

| 特性 | 描述 | 优先级 |
|------|------|--------|
| SPI Motorola | 标准 SPI 模式 | 必须 |
| SPI TI | TI SSP 模式 | 可选 |
| SPI Microwire | National Microwire | 可选 |
| 时钟极性 | CPOL 可配置 | 必须 |
| 时钟相位 | CPHA 可配置 | 必须 |
| 模式 0-3 | 四种 SPI 模式 | 必须 |

### 3.2 功能特性

| 特性 | 描述 | 取值 |
|------|------|------|
| 发送 FIFO | TX 深度 | 32 |
| 接收 FIFO | RX 深度 | 32 |
| 帧长度 | 数据位宽 | 4-16 bits |
| 片选数 | 每通道 CS 数 | 4 |
| 速率配置 | 最高时钟 | 100 MHz |
| 从机选择 | 软件/硬件控制 | 可配置 |

### 3.3 传输模式

| 特性 | 描述 | 优先级 |
|------|------|--------|
| 全双工 | TX/RX 同时 | 必须 |
| 半双工 | 单向传输 | 可选 |
| 环形模式 | TX->RX 环形缓冲 | 可选 |
| 连续传输 | 连续 SCK 输出 | 可选 |
| 延时传输 | CS 到 SCK 延时 | 可配置 |

### 3.4 错误检测

| 特性 | 描述 | 优先级 |
|------|------|--------|
| 溢出错误 | RX FIFO 溢出 | 必须 |
| 欠载错误 | TX FIFO 欠载 | 可选 |
| 帧错误 | 帧格式错误 | 可选 |
| 超时检测 | 传输超时 | 可选 |

---

## 4. GPIO 特性 (128 位)

### 4.1 引脚配置

| 特性 | 描述 | 取值 |
|------|------|------|
| 引脚数量 | GPIO 引脚数 | 128 |
| 方向控制 | 每位独立方向 | 输入/输出/高阻 |
| 上拉电阻 | 可配置上拉 | 10K-100K |
| 下拉电阻 | 可配置下拉 | 10K-100K |
| 驱动能力 | 输出驱动 | 2/4/8/16 mA |
| 速度等级 | 翻转速度 | 25/50/100 MHz |

### 4.2 输入特性

| 特性 | 描述 | 优先级 |
|------|------|--------|
| 去抖动 | 硬件去抖动 | 可选 |
| 边沿检测 | 上升沿/下降沿/双边沿 | 必须 |
| 电平检测 | 高电平/低电平 | 必须 |
| 同步器 | 双触发器同步 | 必须 |
| 读回 | 输入值读回 | 必须 |

### 4.3 输出特性

| 特性 | 描述 | 优先级 |
|------|------|--------|
| 写操作 | 输出值写入 | 必须 |
| 置位/清除 | 原子位操作 | 必须 |
| 翻转 | 位翻转操作 | 必须 |
| 输出使能 | 输出使能控制 | 必须 |
| 写保护 | 防止意外写入 | 可选 |

### 4.4 中断功能

| 特性 | 描述 | 优先级 |
|------|------|--------|
| 中断使能 | 每位独立中断 | 必须 |
| 中断类型 | 边沿/电平 | 必须 |
| 中断极性 | 高/低有效 | 必须 |
| 屏蔽功能 | 中断屏蔽寄存器 | 必须 |
| 状态查询 | 中断状态寄存器 | 必须 |
| 去抖时钟 | 去抖时钟源 | 可配置 |

---

## 5. 中断聚合器

### 5.1 中断源

| 中断源 | 数量 | 类型 |
|--------|------|------|
| I2C 中断 | 4 × 8 = 32 | 脉冲 |
| SPI 中断 | 4 × 6 = 24 | 脉冲 |
| GPIO 中断 | 2 × 4 = 8 | 脉冲 |
| 共享中断 | 64 | 汇总 |

### 5.2 聚合功能

| 特性 | 描述 | 优先级 |
|------|------|--------|
| 优先级编码 | 硬件优先级仲裁 | 必须 |
| 脉冲展宽 | 中断脉冲展宽 | 可选 |
| 中断屏蔽 | 全局/局部屏蔽 | 必须 |
| 唤醒能力 | 唤醒系统 | 可选 |
| 嵌套中断 | 中断嵌套支持 | 可选 |

### 5.3 中断向量

| 特性 | 描述 | 取值 |
|------|------|------|
| 向量宽度 | 中断向量位宽 | 8-bit |
| 最高优先级 | 可配置优先级 | 软件可配 |
| 最低优先级 | 可配置优先级 | 固定 |

---

## 6. APB4 接口

### 6.1 地址映射

| 地址范围 | 子模块 | 大小 |
|----------|--------|------|
| 0x000 - 0x0FF | I2C 控制器 (4ch × 64B) | 256B |
| 0x100 - 0x1FF | SPI 控制器 (4ch × 64B) | 256B |
| 0x200 - 0x3FF | GPIO (2 × 256B) | 512B |
| 0x400 - 0x4FF | 中断聚合器 | 256B |
| 0x500 - 0x7FF | 保留 | 768B |

### 6.2 寄存器访问

| 特性 | 描述 | 优先级 |
|------|------|--------|
| 字节访问 | 8-bit 访问 | 必须 |
| 半字访问 | 16-bit 访问 | 必须 |
| 字访问 | 32-bit 访问 | 必须 |
| 原子操作 | 读-修改-写保护 | 可选 |
| 访问权限 | 特权/用户模式 | 可选 |

---

## 7. 低功耗功能

| 特性 | 描述 | 优先级 |
|------|------|--------|
| 时钟门控 | 动态时钟门控 | 必须 |
| 独立时钟 | 子模块独立时钟 | 必须 |
| 保持寄存器 | 状态保持 | 可选 |
| 唤醒配置 | 唤醒源配置 | 可选 |

---

## 8. 性能指标

### 8.1 时序要求

| 参数 | 描述 | 目标 |
|------|------|------|
| Setup Time | 输入建立时间 | 3ns |
| Hold Time | 输入保持时间 | 1ns |
| Clock to Out | 输出时钟到有效 | 5ns |
| Max Frequency | APB4 频率 | 200MHz |
| SPI Max Freq | SPI 最高频率 | 100MHz |
| I2C Max Freq | I2C 最高频率 | 1MHz |

### 8.2 面积估算

| 模块 | 门数 | 备注 |
|------|------|------|
| I2C ×4 | 8K | 4 通道 I2C |
| SPI ×4 | 10K | 4 通道 SPI |
| GPIO 128 | 5K | 128 位 GPIO |
| INT Agg | 2K | 中断聚合 |
| APB Bridge | 1K | APB 接口 |
| **总计** | **26K** | - |

### 8.3 功耗估算

| 模块 | 动态功耗 | 静态功耗 |
|------|----------|----------|
| I2C ×4 | 8mW | 2mW |
| SPI ×4 | 12mW | 3mW |
| GPIO 128 | 5mW | 1mW |
| INT Agg | 1mW | 0.5mW |
| **总计** | **26mW** | **6.5mW** |

---

## 9. 验证需求

### 9.1 DV 准入标准

| 覆盖率类型 | 目标 | 备注 |
|------------|------|------|
| 代码覆盖率 | 100% | 所有分支/语句 |
| 功能覆盖率 | 100% | 所有功能点 |
| 断言覆盖率 | 100% | 所有协议断言 |

### 9.2 测试用例

| 类别 | 用例数 | 说明 |
|------|--------|------|
| I2C 测试 | 100+ | 各种传输模式 |
| SPI 测试 | 80+ | 各种配置 |
| GPIO 测试 | 50+ | 输入/输出/中断 |
| 中断测试 | 30+ | 中断聚合 |
| 异常测试 | 40+ | 错误注入 |
| 低功耗测试 | 10+ | 时钟门控 |

---

## 10. 交付物清单

| 交付物 | 文件名 | 状态 |
|--------|--------|------|
| 架构文档 | 12_Peripheral_Subsystem_Architecture.md | 完成 |
| Feature List | FEATURE_LIST.md | 本文档 |
| RTL 代码 | *.sv | 进行中 |
| SDC 约束 | i2c_spi_gpio.sdc | 进行中 |
| UVM 环境 | uvm_env/ | 待开发 |
| 测试计划 | testplan_block/ | 待开发 |

---

**文档版本**: V1.0  
**创建日期**: 2026-01-19  
**状态**: 开发中  
**下一步**: RTL 代码开发
