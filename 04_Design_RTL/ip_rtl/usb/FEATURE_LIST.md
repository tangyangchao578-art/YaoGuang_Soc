# Feature List - USB 3.2 Gen2 Controller

## 基本信息
| 项目 | 内容 |
|------|------|
| **模块名称** | usb_controller |
| **版本** | V1.0 |
| **作者** | 前端设计团队 |
| **创建日期** | 2026-01-19 |
| **关联Spec版本** | V1.0 |

---

## Feature列表

| ID | Feature描述 | 优先级 | 验证类型 | 依赖项 | 验收标准 |
|----|------------|--------|----------|--------|----------|
| FE_001 | USB 3.2 Gen2 xHCI接口 | P0 | 功能 | 无 | xHCI寄存器读写正确 |
| FE_002 | USB 2.0 High-Speed支持 | P0 | 功能 | 无 | HS 480Mbps传输正常 |
| FE_003 | USB 2.0 Full-Speed支持 | P0 | 功能 | 无 | FS 12Mbps传输正常 |
| FE_004 | USB 2.0 Low-Speed支持 | P1 | 功能 | 无 | LS 1.5Mbps传输正常 |
| FE_005 | USB 3.2 SuperSpeed+支持 | P0 | 功能 | 无 | SS+ 10Gbps传输正常 |
| FE_006 | xHCI TRB Ring处理 | P0 | 功能 | FE_001 | TRB读取/执行正确 |
| FE_007 | Doorbell寄存器处理 | P0 | 功能 | FE_001 | Doorbell触发传输 |
| FE_008 | USB 2.0 NRZI解码/位填充 | P0 | 功能 | FE_002 | 解码正确，无位填充错误 |
| FE_009 | USB 3.2 8b/10b编解码 | P0 | 功能 | FE_005 | 编解码正确 |
| FE_010 | USB 3.2 Scrambler | P1 | 功能 | FE_005 | 扰码功能正常 |
| FE_011 | 端口连接检测 | P0 | 功能 | 无 | 设备连接/断开检测 |
| FE_012 | 端口速度协商 | P0 | 功能 | FE_002, FE_005 | 速度正确协商 |
| FE_013 | 端口电源管理（BC 1.2） | P1 | 功能 | 无 | 充电协议正常 |
| FE_014 | USB PD支持 | P2 | 功能 | FE_013 | PD协商正常 |
| FE_015 | 多端口支持（4-6 ports） | P1 | 功能 | 无 | 多端口独立工作 |
| FE_016 | 传输完成中断 | P0 | 功能 | 无 | 中断正确产生 |
| FE_017 | 错误检测与恢复 | P1 | 异常 | 无 | 错误检测，传输重试 |
| FE_018 | 热插拔检测 | P0 | 功能 | FE_011 | 热插拔事件正确 |
| FE_019 | AXI4 Slave接口 | P0 | 功能 | 无 | AXI事务正确 |
| FE_020 | 最大Packet Size配置 | P1 | 配置 | 无 | 配置生效 |

---

### FE_001: USB 3.2 Gen2 xHCI接口
- **描述**: 实现xHCI规范定义的Capability和Operational寄存器接口
- **前置条件**: 无
- **测试步骤**:
  1. 读取Capability寄存器
  2. 写入Operational寄存器
  3. 读取Operational寄存器
- **预期结果**: 寄存器读写正确
- **关联需求**: 架构规格3.2

### FE_002: USB 2.0 High-Speed支持
- **描述**: 支持USB 2.0 High-Speed（480Mbps）传输模式
- **前置条件**: PHY就绪
- **测试步骤**:
  1. 连接HS设备
  2. 发起Bulk传输
  3. 测量传输速率
- **预期结果**: 速率达到480Mbps
- **关联需求**: 架构规格3.2

### FE_003: USB 2.0 Full-Speed支持
- **描述**: 支持USB 2.0 Full-Speed（12Mbps）传输模式
- **前置条件**: PHY就绪
- **测试步骤**:
  1. 连接FS设备
  2. 发起Control传输
  3. 检查数据完整性
- **预期结果**: 12Mbps传输正常
- **关联需求**: 架构规格3.2

### FE_004: USB 2.0 Low-Speed支持
- **描述**: 支持USB 2.0 Low-Speed（1.5Mbps）传输模式
- **前置条件**: PHY就绪
- **测试步骤**:
  1. 连接LS设备
  2. 发起Interrupt传输
- **预期结果**: 1.5Mbps传输正常
- **关联需求**: 架构规格3.2

### FE_005: USB 3.2 SuperSpeed+支持
- **描述**: 支持USB 3.2 SuperSpeed+（10Gbps）传输模式
- **前置条件**: PHY就绪，USB3模式启用
- **测试步骤**:
  1. 连接SS+设备
  2. 发起Bulk传输
  3. 测量传输速率
- **预期结果**: 速率达到10Gbps
- **关联需求**: 架构规格3.2

### FE_006: xHCI TRB Ring处理
- **描述**: 实现Transfer Request Block Ring的读取和执行
- **前置条件**: FE_001
- **测试步骤**:
  1. 配置TRB Ring Base
  2. 配置Transfer TRB
  3. 触发Doorbell
  4. 检查TRB执行
- **预期结果**: TRB正确执行
- **关联需求**: 架构规格3.2

### FE_007: Doorbell寄存器处理
- **描述**: 实现Doorbell寄存器和命令分发
- **前置条件**: FE_001
- **测试步骤**:
  1. 写入Doorbell寄存器
  2. 检查对应Endpoint激活
- **预期结果**: Doorbell正确触发传输
- **关联需求**: 架构规格3.2

### FE_008: USB 2.0 NRZI解码/位填充
- **描述**: 实现USB 2.0 NRZI解码和位填充/去填充
- **前置条件**: FE_002
- **测试步骤**:
  1. 发送带位填充的数据
  2. 检查解码结果
- **预期结果**: 解码正确
- **关联需求**: 架构规格3.2

### FE_009: USB 3.2 8b/10b编解码
- **描述**: 实现USB 3.2必需的8b/10b编解码
- **前置条件**: FE_005
- **测试步骤**:
  1. 注入数据
  2. 检查编码输出
  3. 检查解码恢复
- **预期结果**: 编解码正确
- **关联需求**: 架构规格3.2

### FE_010: USB 3.2 Scrambler
- **描述**: 实现USB 3.2数据扰码功能
- **前置条件**: FE_005
- **测试步骤**:
  1. 启用扰码
  2. 检查输出
  3. 对比禁用状态
- **预期结果**: 扰码功能正常
- **关联需求**: 架构规格3.2

### FE_011: 端口连接检测
- **描述**: 实现USB端口连接和断开检测
- **前置条件**: 无
- **测试步骤**:
  1. 连接设备
  2. 检查连接中断
  3. 断开设备
  4. 检查断开中断
- **预期结果**: 连接事件正确
- **关联需求**: 架构规格3.2

### FE_012: 端口速度协商
- **描述**: 实现USB端口速度自动协商
- **前置条件**: FE_011
- **测试步骤**:
  1. 连接不同速度设备
  2. 检查协商速度
- **预期结果**: 速度正确协商
- **关联需求**: 架构规格3.2

### FE_013: 端口电源管理（BC 1.2）
- **描述**: 实现Battery Charging 1.2规范的充电支持
- **前置条件**: 无
- **测试步骤**:
  1. 连接充电设备
  2. 检查充电电流
- **预期结果**: 充电协议正常
- **关联需求**: 架构规格3.2

### FE_014: USB PD支持
- **描述**: 支持USB Power Delivery协议
- **前置条件**: FE_013
- **测试步骤**:
  1. 发起PD协商
  2. 检查功率变化
- **预期结果**: PD协商正常
- **关联需求**: 架构规格3.2

### FE_015: 多端口支持（4-6 ports）
- **描述**: 支持4-6个独立USB端口
- **前置条件**: 无
- **测试步骤**:
  1. 连接多个设备
  2. 并行传输
- **预期结果**: 多端口独立工作
- **关联需求**: 架构规格3.2

### FE_016: 传输完成中断
- **描述**: 实现传输完成中断生成
- **前置条件**: FE_006
- **测试步骤**:
  1. 完成传输
  2. 检查中断
- **预期结果**: 中断正确产生
- **关联需求**: 架构规格3.2

### FE_017: 错误检测与恢复
- **描述**: 实现传输错误检测和恢复机制
- **前置条件**: FE_006
- **测试步骤**:
  1. 注入传输错误
  2. 检查错误处理
  3. 检查重传
- **预期结果**: 错误检测并重传
- **关联需求**: 架构规格3.2

### FE_018: 热插拔检测
- **描述**: 实现USB设备热插拔检测
- **前置条件**: FE_011
- **测试步骤**:
  1. 动态插拔设备
  2. 检查事件
- **预期结果**: 热插拔事件正确
- **关联需求**: 架构规格3.2

### FE_019: AXI4 Slave接口
- **描述**: 实现AXI4 Slave接口供CPU访问
- **前置条件**: 无
- **测试步骤**:
  1. 发起AXI Read/Write
  2. 检查响应
- **预期结果**: AXI事务正确
- **关联需求**: 架构规格3.2

### FE_020: 最大Packet Size配置
- **描述**: 支持配置Endpoint最大Packet Size
- **前置条件**: FE_006
- **测试步骤**:
  1. 配置Max Packet Size
  2. 发送相应大小包
- **预期结果**: 配置生效
- **关联需求**: 架构规格3.2

---

## 验证资源估算

| 类别 | 数量 | 备注 |
|------|------|------|
| **功能测试用例** | 60+ | xHCI/TRB/传输 |
| **异常测试用例** | 25+ | 错误注入 |
| **配置测试用例** | 15+ | 模式切换 |
| **性能测试用例** | 10+ | 带宽测试 |
| **仿真时间预估** | 600+小时 | 回归测试 |

---

## 追溯矩阵

| Feature ID | 架构需求 | 设计规格 |
|------------|----------|----------|
| FE_001 | 3.2.1 | 5.2.1 |
| FE_002 | 3.2.2 | 5.2.2 |
| FE_003 | 3.2.2 | 5.2.2 |
| FE_004 | 3.2.2 | 5.2.2 |
| FE_005 | 3.2.3 | 5.2.3 |
| FE_006 | 3.2.4 | 5.2.4 |
| FE_007 | 3.2.4 | 5.2.4 |
| FE_008 | 3.2.5 | 5.2.5 |
| FE_009 | 3.2.6 | 5.2.6 |
| FE_010 | 3.2.6 | 5.2.6 |

---

**文档版本**: V1.0  
**创建日期**: 2026-01-19  
**状态**: 已交付DV
