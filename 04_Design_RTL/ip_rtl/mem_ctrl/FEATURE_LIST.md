# LPDDR5 内存控制器 Feature List

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | V1.0 |
| 创建日期 | 2026-01-18 |
| 状态 | 已批准 |
| 负责人 | 前端设计工程师 |
| 关联文档 | 02_Architecture/06_Memory_Subsystem_Architecture.md |

---

## 1. 特性概览

| 特性 ID | 特性名称 | 优先级 | 来源章节 | 状态 |
|---------|----------|--------|----------|------|
| F_MC_001 | LPDDR5 控制器顶层架构 | P0 | 2.1 | 待开发 |
| F_MC_002 | AXI4 从接口 | P0 | 2.4 | 待开发 |
| F_MC_003 | 命令队列 (64 entries) | P0 | 2.1 | 待开发 |
| F_MC_004 | 事务重排 (32 transactions) | P1 | 2.1 | 待开发 |
| F_MC_005 | QoS 调度 (优先级仲裁) | P1 | 2.4 | 待开发 |
| F_MC_006 | 命令调度器 | P0 | 2.4 | 待开发 |
| F_MC_007 | 行激活调度 | P1 | 2.4 | 待开发 |
| F_MC_008 | 刷新调度 (自动/手动) | P0 | 2.4 | 待开发 |
| F_MC_009 | 功耗状态管理 | P1 | 2.4, 2.5 | 待开发 |
| F_MC_010 | DFI 4.0 PHY 接口 | P0 | 2.4 | 待开发 |
| F_MC_011 | PHY 时序参数编程 | P0 | 2.4 | 待开发 |
| F_MC_012 | 训练引擎 (eye training) | P0 | 2.4 | 待开发 |
| F_MC_013 | SECDED ECC 编码器 | **P0** | 2.1, 9.1 | 待开发 |
| F_MC_014 | SECDED ECC 解码器 | **P0** | 2.1, 9.1 | 待开发 |
| F_MC_015 | ECC 错误注入测试 | P1 | 10.2 | 待开发 |
| F_MC_016 | LPDDR5 命令编码 | P0 | 3.1 | 待开发 |
| F_MC_017 | 读写数据路径 | P0 | 3.1 | 待开发 |
| F_MC_018 | 写数据掩码 (DM) | P1 | 3.1 | 待开发 |
| F_MC_019 | ODT 控制 | P1 | 3.1 | 待开发 |
| F_MC_020 | 时钟门控 | P1 | 3.2 | 待开发 |

---

## 2. 详细特性说明

### 2.1 P0 - 核心功能特性

#### F_MC_001: LPDDR5 控制器顶层架构

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 来源 | 架构文档 2.1 |
| 描述 | 实现完整的 LPDDR5 控制器顶层架构，支持 6400 MT/s 数据速率 |
| 输入 | AXI4 事务请求 |
| 输出 | DRAM 命令/数据 |
| 约束 | 2 x 16-bit 通道, 200 GB/s 带宽 |
| 验证要点 | 功能正确性, 时序收敛 |

#### F_MC_002: AXI4 从接口

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 来源 | 架构文档 2.4 |
| 描述 | 实现 AXI4 Slave 接口，支持读写事务处理 |
| 信号 | AW*, AR*, W*, R*, B* channels |
| 特性 | 支持 Out-of-order, Outstanding 事务 |
| 验证要点 | AXI4 协议一致性 |

#### F_MC_003: 命令队列 (64 entries)

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 来源 | 架构文档 2.1 |
| 描述 | 实现 64 条目命令队列，支持事务暂存与调度 |
| 深度 | 64 entries |
| 宽度 | 支持完整 AXI 事务 |
| 特性 | FIFO 管理, 溢出保护 |
| 验证要点 | 队列满/空状态, 正确出队顺序 |

#### F_MC_006: 命令调度器

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 来源 | 架构文档 2.4 |
| 描述 | 实现 DRAM 命令调度器，优化 bank 利用率 |
| 调度策略 | 行激活调度, Bank 冲突避免 |
| 输入 | 命令队列, Bank 状态 |
| 输出 | DRAM 时序正确的命令序列 |
| 验证要点 | 时序约束满足, 调度效率 |

#### F_MC_008: 刷新调度 (自动/手动)

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 来源 | 架构文档 2.4, 2.3 |
| 描述 | 实现 DRAM 刷新调度，支持自动和手动两种模式 |
| 刷新间隔 | 7.8 μs tREFI |
| 模式 | 自动刷新 (按固定间隔), 手动刷新 (软件触发) |
| 特性 | 刷新期间事务暂停, 刷新完成中断 |
| 验证要点 | 刷新时序, 刷新期间数据一致性 |

#### F_MC_010: DFI 4.0 PHY 接口

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 来源 | 架构文档 2.4 |
| 描述 | 实现 DFI 4.0 接口，与 PHY 层通信 |
| 标准 | DFI 4.0 |
| 信号 | DFI 地址/命令/数据总线, 控制信号 |
| 特性 | 双向数据总线, 时序参数可编程 |
| 验证要点 | DFI 协议一致性, PHY 互操作性 |

#### F_MC_011: PHY 时序参数编程

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 来源 | 架构文档 2.4 |
| 描述 | 实现 PHY 时序参数的寄存器编程接口 |
| 参数 | tRCD, tRP, tRTP, tWR, tRFC 等 |
| 寄存器 | CSR (Control/Status Registers) |
| 访问 | APB/AXI-Lite 接口 |
| 验证要点 | 参数写入生效, 时序改善 |

#### F_MC_012: 训练引擎 (eye training)

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 来源 | 架构文档 2.4 |
| 描述 | 实现 DRAM 初始化和训练序列生成 |
| 训练类型 | Write Leveling, Read Leveling, Eye Training |
| 序列 | MRS (Mode Register Set), ZQ Calibration |
| 特性 | 自动化训练流程, 训练结果状态寄存器 |
| 验证要点 | 训练成功, 读写窗口优化 |

#### F_MC_013: SECDED ECC 编码器

| 属性 | 值 |
|------|-----|
| 优先级 | **P0** (必选) |
| 来源 | 架构文档 2.1, 9.1 |
| 描述 | 实现 SECDED ECC 编码器，支持车载 ASIL-D 安全要求 |
| 编码类型 | SECDED (Single Error Correction, Double Error Detection) |
| 数据宽度 | 64-bit 数据 + 8-bit ECC |
| 编码延迟 | 1 cycle |
| 验证要点 | 编码正确性, 纠错能力验证 |

#### F_MC_014: SECDED ECC 解码器

| 属性 | 值 |
|------|-----|
| 优先级 | **P0** (必选) |
| 来源 | 架构文档 2.1, 9.1 |
| 描述 | 实现 SECDED ECC 解码器，支持错误检测与纠正 |
| 解码类型 | SECDED |
| 数据宽度 | 64-bit 数据 + 8-bit ECC |
| 检测能力 | 2-bit 错误检测 |
| 纠正能力 | 1-bit 错误纠正 |
| 检测延迟 | 1 cycle |
| 纠正延迟 | 2 cycles |
| 错误响应 | 中断信号, 错误计数器 |
| 验证要点 | 单比特纠正, 双比特检测 |

#### F_MC_016: LPDDR5 命令编码

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 来源 | 架构文档 3.1 |
| 描述 | 实现完整的 LPDDR5 命令编码逻辑 |
| 命令类型 | ACT, PRE, PREPB, RE, REF, MRS, SREF, PDE, PDX |
| 信号 | CS_n, RAS_n, CAS_n, WE_n, ACT_n, CKE, ODT |
| 验证要点 | 命令时序, 信号完整性 |

#### F_MC_017: 读写数据路径

| 属性 | 值 |
|------|-----|
| 优先级 | P0 |
| 来源 | 架构文档 3.1 |
| 描述 | 实现读/写数据路径，包括数据缓冲与序列化 |
| 读路径 | DQ 输入 -> 解串 -> ECC 解码 -> 数据缓冲 |
| 写路径 | 数据缓冲 -> ECC 编码 -> 串化 -> DQ 输出 |
| 数据宽度 | 16-bit per channel |
| 验证要点 | 数据正确性, 吞吐量 |

---

### 2.2 P1 - 增强功能特性

#### F_MC_004: 事务重排 (32 transactions)

| 属性 | 值 |
|------|-----|
| 优先级 | P1 |
| 来源 | 架构文档 2.1 |
| 描述 | 实现事务重排机制，提高 DRAM bank 利用率 |
| 重排深度 | 32 transactions |
| 策略 | 行命中优先, bank 冲突避免 |
| 特性 | 乱序提交, 保序选项 |
| 验证要点 | 重排正确性, 性能提升 |

#### F_MC_005: QoS 调度 (优先级仲裁)

| 属性 | 值 |
|------|-----|
| 优先级 | P1 |
| 来源 | 架构文档 2.4 |
| 描述 | 实现 QoS 调度，支持优先级仲裁 |
| 优先级级别 | 4-level (0-3) |
| 仲裁策略 | 优先级加权轮询 |
| 特性 | 带宽保证, 延迟预算 |
| 验证要点 | 优先级正确性, 带宽分配 |

#### F_MC_007: 行激活调度

| 属性 | 值 |
|------|-----|
| 优先级 | P1 |
| 来源 | 架构文档 2.4 |
| 描述 | 实现行激活调度策略，最小化行冲突 |
| 调度策略 | Open Page, Close Page (可配置) |
| 预取策略 | 顺序/跨度预取 |
| 验证要点 | 行管理正确性, 命中率 |

#### F_MC_009: 功耗状态管理

| 属性 | 值 |
|------|-----|
| 优先级 | P1 |
| 来源 | 架构文档 2.4, 2.5 |
| 描述 | 实现多级功耗状态管理 |
| 状态 | Active, Power-down, Self-refresh, Deep Power-down |
| 进入条件 | 无访问超时, 软件指令 |
| 功耗节省 | 50mW-2.5W 动态调整 |
| 验证要点 | 状态切换, 唤醒延迟 |

#### F_MC_015: ECC 错误注入测试

| 属性 | 值 |
|------|-----|
| 优先级 | P1 |
| 来源 | 架构文档 10.2 |
| 描述 | 实现 ECC 错误注入测试机制 |
| 注入类型 | 单比特翻转, 双比特翻转 |
| 控制 | 寄存器配置, 错误注入触发 |
| 验证要点 | 检测/纠正率, 中断响应 |

#### F_MC_018: 写数据掩码 (DM)

| 属性 | 值 |
|------|-----|
| 优先级 | P1 |
| 来源 | 架构文档 3.1 |
| 描述 | 实现写数据掩码功能，支持部分字写入 |
| 掩码粒度 | 8-bit (DM) / 16-bit (DBI) |
| 特性 | DBI (Data Bus Inversion) 可选 |
| 验证要点 | 掩码正确性, 数据完整性 |

#### F_MC_019: ODT 控制

| 属性 | 值 |
|------|-----|
| 优先级 | P1 |
| 来源 | 架构文档 3.1 |
| 描述 | 实现 On-Die Termination 控制，优化信号完整性 |
| ODT 值 | RZQ/1, RZQ/2, RZQ/3, RZQ/4, RZQ/6, RZQ/8 |
| 控制时机 | 写命令期间, 读命令期间 |
| 验证要点 | 终端匹配, 信号质量 |

#### F_MC_020: 时钟门控

| 属性 | 值 |
|------|-----|
| 优先级 | P1 |
| 来源 | 架构文档 3.2 |
| 描述 | 实现时钟门控，降低动态功耗 |
| 门控粒度 | 模块级, bank 级 |
| 特性 | 活动检测, 门控延迟 < 1 cycle |
| 验证要点 | 门控效率, 时序影响 |

---

## 3. 追溯矩阵

### 3.1 特性到架构需求追溯

| 特性 ID | 架构章节 | 架构需求 | 验证方法 |
|---------|----------|----------|----------|
| F_MC_001 | 2.1, 2.4 | 控制器顶层架构 | RTL 仿真, 形式验证 |
| F_MC_002 | 2.4 | AXI4 接口 | AXI VIP, 协议检查 |
| F_MC_003 | 2.1 | 命令队列 64 entries | 功能覆盖, 队列验证 |
| F_MC_004 | 2.1 | 事务重排 32 | 性能仿真, 正确性验证 |
| F_MC_005 | 2.4 | QoS 调度 | 优先级测试, 带宽测试 |
| F_MC_006 | 2.4 | 命令调度器 | 时序仿真, bank 利用率 |
| F_MC_007 | 2.4 | 行激活调度 | 行命中率分析 |
| F_MC_008 | 2.3, 2.4 | 刷新调度 7.8μs | 时序验证, 刷新测试 |
| F_MC_009 | 2.5 | 功耗状态管理 | 功耗仿真, 状态切换 |
| F_MC_010 | 2.4 | DFI 4.0 接口 | DFI 协议验证 |
| F_MC_011 | 2.4 | 时序参数编程 | CSR 读写验证 |
| F_MC_012 | 2.4 | 训练引擎 | 训练序列验证 |
| F_MC_013 | 2.1, 9.1 | ECC 编码 ASIL-D | 编码覆盖, 故障注入 |
| F_MC_014 | 2.1, 9.1 | ECC 解码 ASIL-D | 故障注入, 中断验证 |
| F_MC_015 | 10.2 | ECC 测试 | 错误注入测试 |
| F_MC_016 | 3.1 | LPDDR5 命令 | 命令时序验证 |
| F_MC_017 | 3.1 | 读写数据路径 | 数据完整性验证 |
| F_MC_018 | 3.1 | DM/DBI 控制 | 掩码功能验证 |
| F_MC_019 | 3.1 | ODT 控制 | 信号完整性仿真 |
| F_MC_020 | 3.2 | 时钟门控 | 功耗分析 |

### 3.2 安全特性追溯

| 安全需求 | 相关特性 | ASIL 等级 | 安全机制 |
|----------|----------|-----------|----------|
| ECC 保护 | F_MC_013, F_MC_014 | ASIL-D | SECDED |
| 读写保护 | F_MC_002 | ASIL-B | 地址过滤 |
| 错误检测 | F_MC_014, F_MC_015 | ASIL-D | ECC 中断 |
| 故障响应 | F_MC_014 | ASIL-D | 错误记录 |

---

## 4. 开发计划

### 4.1 开发阶段

| 阶段 | 特性 | 预计工期 |
|------|------|----------|
| Phase 1 | F_MC_001, F_MC_002, F_MC_003 | 3 周 |
| Phase 2 | F_MC_006, F_MC_008, F_MC_016 | 3 周 |
| Phase 3 | F_MC_010, F_MC_011, F_MC_012 | 3 周 |
| Phase 4 | F_MC_013, F_MC_014 (ECC) | 2 周 |
| Phase 5 | F_MC_004, F_MC_005, F_MC_007 | 2 周 |
| Phase 6 | F_MC_009, F_MC_015, F_MC_017-020 | 2 周 |
| **总计** | **20 个特性** | **15 周** |

### 4.2 资源分配

| 模块 | 开发人员 | 验证人员 | 依赖 |
|------|----------|----------|------|
| 顶层架构 | 前端 DE | DV | - |
| AXI 接口 | 前端 DE | DV | - |
| 命令队列 | 前端 DE | DV | - |
| 命令调度器 | 前端 DE | DV | Phase 1 |
| PHY 接口 | 前端 DE | DV | Phase 2 |
| ECC | 前端 DE (FuSa 复核) | DV | Phase 3 |

---

## 5. 验收标准

### 5.1 功能验收

- [ ] 所有 P0 特性 100% 功能覆盖
- [ ] AXI4 协议一致性 100%
- [ ] LPDDR5 时序规格 100% 满足
- [ ] ECC SECDED 功能验证通过

### 5.2 性能验收

- [ ] 200 GB/s 带宽达成
- [ ] 命令队列无Overflow
- [ ] 事务重排效率 > 20%

### 5.3 安全验收

- [ ] ECC 单比特纠正验证
- [ ] ECC 双比特检测验证
- [ ] FuSa 专家签字认可

---

**文档版本**: V1.0  
**批准日期**: 2026-01-18  
**下次评审**: RTL 代码冻结时
